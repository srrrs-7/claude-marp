<svg viewBox="0 0 900 400" xmlns="http://www.w3.org/2000/svg" style="max-height:70vh;width:auto;display:block;margin:0 auto;letter-spacing:0">
  <rect width="900" height="400" fill="#1a0a2e" rx="12"/>
  <text x="450" y="32" text-anchor="middle" font-family="Arial,sans-serif" font-size="17" font-weight="bold" fill="#ffffff">Advanced RAG パターン</text>
  <text x="450" y="52" text-anchor="middle" font-family="Arial,sans-serif" font-size="11" fill="#a78bfa">HyDE・Re-rank・Query Expansion・Parent-Child Retrieval</text>

  <!-- HyDE -->
  <rect x="15" y="65" width="205" height="175" rx="8" fill="#172554" stroke="#3b82f6" stroke-width="2"/>
  <rect x="15" y="65" width="205" height="28" rx="8" fill="#1d4ed8"/>
  <text x="118" y="83" text-anchor="middle" font-family="Arial,sans-serif" font-size="12" font-weight="bold" fill="#ffffff">HyDE</text>
  <text x="118" y="108" text-anchor="middle" font-family="Arial,sans-serif" font-size="9" fill="#93c5fd">Hypothetical Document Embeddings</text>
  <text x="118" y="125" text-anchor="middle" font-family="Arial,sans-serif" font-size="10" fill="#60a5fa">クエリ → LLMで仮想回答生成</text>
  <polygon points="118,138 113,130 123,130" fill="#fbbf24"/>
  <text x="118" y="152" text-anchor="middle" font-family="Arial,sans-serif" font-size="10" fill="#60a5fa">仮想回答をベクター化</text>
  <polygon points="118,163 113,155 123,155" fill="#fbbf24"/>
  <text x="118" y="177" text-anchor="middle" font-family="Arial,sans-serif" font-size="10" fill="#60a5fa">類似ドキュメント検索</text>
  <text x="118" y="197" text-anchor="middle" font-family="Arial,sans-serif" font-size="9" fill="#fbbf24">精度↑（回答空間で検索）</text>
  <text x="118" y="232" text-anchor="middle" font-family="Arial,sans-serif" font-size="9" fill="#475569">コスト: LLM呼び出し×2</text>

  <!-- Re-ranking -->
  <rect x="232" y="65" width="205" height="175" rx="8" fill="#3b0764" stroke="#a855f7" stroke-width="2"/>
  <rect x="232" y="65" width="205" height="28" rx="8" fill="#6d28d9"/>
  <text x="335" y="83" text-anchor="middle" font-family="Arial,sans-serif" font-size="12" font-weight="bold" fill="#ffffff">Re-ranking</text>
  <text x="335" y="108" text-anchor="middle" font-family="Arial,sans-serif" font-size="9" fill="#c4b5fd">Cross-Encoder Model で再スコアリング</text>
  <text x="335" y="125" text-anchor="middle" font-family="Arial,sans-serif" font-size="10" fill="#c4b5fd">初期検索: Top-50取得</text>
  <polygon points="335,138 330,130 340,130" fill="#fbbf24"/>
  <text x="335" y="152" text-anchor="middle" font-family="Arial,sans-serif" font-size="10" fill="#c4b5fd">Re-rankerで精密スコア</text>
  <polygon points="335,163 330,155 340,155" fill="#fbbf24"/>
  <text x="335" y="177" text-anchor="middle" font-family="Arial,sans-serif" font-size="10" fill="#c4b5fd">Top-5を最終選択</text>
  <text x="335" y="197" text-anchor="middle" font-family="Arial,sans-serif" font-size="9" fill="#fbbf24">精度↑（クエリ文脈を考慮）</text>
  <text x="335" y="232" text-anchor="middle" font-family="Arial,sans-serif" font-size="9" fill="#475569">Bedrock Re-ranking APIで実装</text>

  <!-- Query Expansion -->
  <rect x="449" y="65" width="205" height="175" rx="8" fill="#064e3b" stroke="#10b981" stroke-width="2"/>
  <rect x="449" y="65" width="205" height="28" rx="8" fill="#065f46"/>
  <text x="552" y="83" text-anchor="middle" font-family="Arial,sans-serif" font-size="12" font-weight="bold" fill="#ffffff">Query Expansion</text>
  <text x="552" y="108" text-anchor="middle" font-family="Arial,sans-serif" font-size="9" fill="#6ee7b7">クエリを複数の形式に拡張して並列検索</text>
  <text x="552" y="125" text-anchor="middle" font-family="Arial,sans-serif" font-size="10" fill="#34d399">元クエリ: 「機械学習とは」</text>
  <polygon points="552,138 547,130 557,130" fill="#fbbf24"/>
  <text x="552" y="152" text-anchor="middle" font-family="Arial,sans-serif" font-size="10" fill="#6ee7b7">拡張1: 「ML アルゴリズム」</text>
  <text x="552" y="166" text-anchor="middle" font-family="Arial,sans-serif" font-size="10" fill="#6ee7b7">拡張2: 「AI 学習手法」</text>
  <text x="552" y="180" text-anchor="middle" font-family="Arial,sans-serif" font-size="10" fill="#6ee7b7">並列検索 → 結果統合</text>
  <text x="552" y="200" text-anchor="middle" font-family="Arial,sans-serif" font-size="9" fill="#fbbf24">Recall↑（多角度から検索）</text>
  <text x="552" y="232" text-anchor="middle" font-family="Arial,sans-serif" font-size="9" fill="#475569">コスト: 検索回数分増加</text>

  <!-- Parent-Child Retrieval -->
  <rect x="666" y="65" width="219" height="175" rx="8" fill="#78350f" stroke="#f59e0b" stroke-width="2"/>
  <rect x="666" y="65" width="219" height="28" rx="8" fill="#92400e"/>
  <text x="776" y="83" text-anchor="middle" font-family="Arial,sans-serif" font-size="12" font-weight="bold" fill="#ffffff">Parent-Child Retrieval</text>
  <text x="776" y="108" text-anchor="middle" font-family="Arial,sans-serif" font-size="9" fill="#fde68a">子で精密検索 → 親で文脈保持</text>
  <rect x="676" y="115" width="200" height="18" rx="3" fill="#7c2d12"/>
  <text x="776" y="128" text-anchor="middle" font-family="Arial,sans-serif" font-size="9" fill="#fbbf24">親チャンク（2000トークン）</text>
  <rect x="696" y="137" width="80" height="18" rx="3" fill="#92400e"/>
  <rect x="790" y="137" width="80" height="18" rx="3" fill="#92400e"/>
  <text x="736" y="150" text-anchor="middle" font-family="Arial,sans-serif" font-size="8" fill="#fde68a">子(200tok)</text>
  <text x="830" y="150" text-anchor="middle" font-family="Arial,sans-serif" font-size="8" fill="#fde68a">子(200tok)</text>
  <text x="776" y="175" text-anchor="middle" font-family="Arial,sans-serif" font-size="10" fill="#fde68a">子で検索（精度高）</text>
  <text x="776" y="191" text-anchor="middle" font-family="Arial,sans-serif" font-size="10" fill="#fbbf24">→ 親チャンクを返す（文脈豊）</text>
  <text x="776" y="208" text-anchor="middle" font-family="Arial,sans-serif" font-size="9" fill="#fbbf24">精度と文脈の両立</text>
  <text x="776" y="232" text-anchor="middle" font-family="Arial,sans-serif" font-size="9" fill="#475569">Bedrock KBの階層型チャンキング</text>

  <!-- Summary -->
  <rect x="15" y="252" width="870" height="136" rx="8" fill="#0f172a"/>
  <text x="450" y="272" text-anchor="middle" font-family="Arial,sans-serif" font-size="12" font-weight="bold" fill="#fbbf24">Advanced RAG 選択ガイド（試験頻出）</text>
  <rect x="30" y="283" width="195" height="92" rx="5" fill="#172554"/>
  <text x="128" y="303" text-anchor="middle" font-family="Arial,sans-serif" font-size="10" font-weight="bold" fill="#60a5fa">HyDE</text>
  <text x="128" y="319" text-anchor="middle" font-family="Arial,sans-serif" font-size="9" fill="#93c5fd">クエリが短い・抽象的</text>
  <text x="128" y="335" text-anchor="middle" font-family="Arial,sans-serif" font-size="9" fill="#93c5fd">初期検索精度が低い</text>
  <text x="128" y="359" text-anchor="middle" font-family="Arial,sans-serif" font-size="9" fill="#475569">+LLM呼び出しコスト</text>
  <rect x="240" y="283" width="195" height="92" rx="5" fill="#3b0764"/>
  <text x="338" y="303" text-anchor="middle" font-family="Arial,sans-serif" font-size="10" font-weight="bold" fill="#c4b5fd">Re-ranking</text>
  <text x="338" y="319" text-anchor="middle" font-family="Arial,sans-serif" font-size="9" fill="#a78bfa">検索精度が重要</text>
  <text x="338" y="335" text-anchor="middle" font-family="Arial,sans-serif" font-size="9" fill="#a78bfa">多くの候補から絞込</text>
  <text x="338" y="359" text-anchor="middle" font-family="Arial,sans-serif" font-size="9" fill="#475569">Bedrock Re-ranking API</text>
  <rect x="450" y="283" width="195" height="92" rx="5" fill="#064e3b"/>
  <text x="548" y="303" text-anchor="middle" font-family="Arial,sans-serif" font-size="10" font-weight="bold" fill="#6ee7b7">Query Expansion</text>
  <text x="548" y="319" text-anchor="middle" font-family="Arial,sans-serif" font-size="9" fill="#34d399">質問が多義的・曖昧</text>
  <text x="548" y="335" text-anchor="middle" font-family="Arial,sans-serif" font-size="9" fill="#34d399">Recallを上げたい</text>
  <text x="548" y="359" text-anchor="middle" font-family="Arial,sans-serif" font-size="9" fill="#475569">レイテンシ・コスト増</text>
  <rect x="660" y="283" width="220" height="92" rx="5" fill="#78350f"/>
  <text x="770" y="303" text-anchor="middle" font-family="Arial,sans-serif" font-size="10" font-weight="bold" fill="#fde68a">Parent-Child</text>
  <text x="770" y="319" text-anchor="middle" font-family="Arial,sans-serif" font-size="9" fill="#fbbf24">長文書・文脈重要</text>
  <text x="770" y="335" text-anchor="middle" font-family="Arial,sans-serif" font-size="9" fill="#fbbf24">精度と文脈を両立したい</text>
  <text x="770" y="359" text-anchor="middle" font-family="Arial,sans-serif" font-size="9" fill="#475569">階層型チャンキング選択</text>
</svg>

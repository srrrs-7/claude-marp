<svg viewBox="0 0 900 420" xmlns="http://www.w3.org/2000/svg" style="max-height:70vh;width:auto;display:block;margin:0 auto;letter-spacing:0">
  <rect width="900" height="420" fill="#1a0a2e" rx="12"/>
  <text x="450" y="32" text-anchor="middle" font-family="Arial,sans-serif" font-size="17" font-weight="bold" fill="#ffffff">RAG アーキテクチャ詳細フロー</text>
  <text x="450" y="52" text-anchor="middle" font-family="Arial,sans-serif" font-size="11" fill="#a78bfa">Offline（インデックス作成）と Online（推論）の2フェーズ</text>

  <!-- Offline phase -->
  <rect x="15" y="65" width="430" height="205" rx="8" fill="#1e1b4b" stroke="#6d28d9" stroke-width="2"/>
  <rect x="15" y="65" width="430" height="30" rx="8" fill="#4c1d95"/>
  <text x="230" y="85" text-anchor="middle" font-family="Arial,sans-serif" font-size="13" font-weight="bold" fill="#e9d5ff">Offline フェーズ（インデックス作成）</text>

  <!-- Step 1: Documents -->
  <rect x="30" y="105" width="90" height="60" rx="5" fill="#172554"/>
  <text x="75" y="125" text-anchor="middle" font-family="Arial,sans-serif" font-size="10" font-weight="bold" fill="#93c5fd">① ドキュメント</text>
  <text x="75" y="141" text-anchor="middle" font-family="Arial,sans-serif" font-size="9" fill="#60a5fa">PDF, Word</text>
  <text x="75" y="155" text-anchor="middle" font-family="Arial,sans-serif" font-size="9" fill="#60a5fa">HTML, CSV</text>
  <polygon points="123,135 135,131 135,139" fill="#6d28d9"/>

  <!-- Step 2: Chunking -->
  <rect x="138" y="105" width="90" height="60" rx="5" fill="#3b0764"/>
  <text x="183" y="125" text-anchor="middle" font-family="Arial,sans-serif" font-size="10" font-weight="bold" fill="#c4b5fd">② チャンキング</text>
  <text x="183" y="141" text-anchor="middle" font-family="Arial,sans-serif" font-size="9" fill="#a78bfa">分割サイズ設定</text>
  <text x="183" y="155" text-anchor="middle" font-family="Arial,sans-serif" font-size="9" fill="#a78bfa">オーバーラップ</text>
  <polygon points="231,135 243,131 243,139" fill="#6d28d9"/>

  <!-- Step 3: Embedding -->
  <rect x="246" y="105" width="90" height="60" rx="5" fill="#064e3b"/>
  <text x="291" y="122" text-anchor="middle" font-family="Arial,sans-serif" font-size="10" font-weight="bold" fill="#6ee7b7">③ エンベディング</text>
  <text x="291" y="138" text-anchor="middle" font-family="Arial,sans-serif" font-size="9" fill="#34d399">Titan Emb V2</text>
  <text x="291" y="152" text-anchor="middle" font-family="Arial,sans-serif" font-size="9" fill="#34d399">→ ベクター変換</text>
  <polygon points="339,135 351,131 351,139" fill="#6d28d9"/>

  <!-- Step 4: Vector Store -->
  <rect x="354" y="105" width="78" height="60" rx="5" fill="#78350f"/>
  <text x="393" y="122" text-anchor="middle" font-family="Arial,sans-serif" font-size="10" font-weight="bold" fill="#fde68a">④ Vector DB</text>
  <text x="393" y="138" text-anchor="middle" font-family="Arial,sans-serif" font-size="9" fill="#fbbf24">OpenSearch</text>
  <text x="393" y="152" text-anchor="middle" font-family="Arial,sans-serif" font-size="9" fill="#fbbf24">格納・索引</text>

  <!-- Metadata box -->
  <rect x="30" y="180" width="410" height="75" rx="6" fill="#0f172a"/>
  <text x="235" y="200" text-anchor="middle" font-family="Arial,sans-serif" font-size="11" font-weight="bold" fill="#fbbf24">チャンク + メタデータを同時保存</text>
  <text x="235" y="220" text-anchor="middle" font-family="Arial,sans-serif" font-size="10" fill="#93c5fd">メタデータ: ソースURL, ページ番号, 作成日時, カテゴリ, 著者 → フィルタリングに活用</text>
  <text x="235" y="238" text-anchor="middle" font-family="Arial,sans-serif" font-size="10" fill="#60a5fa">チャンクテキスト + ベクター + メタデータの3点セットで1レコード</text>

  <!-- Online phase -->
  <rect x="455" y="65" width="430" height="205" rx="8" fill="#051f1e" stroke="#10b981" stroke-width="2"/>
  <rect x="455" y="65" width="430" height="30" rx="8" fill="#065f46"/>
  <text x="670" y="85" text-anchor="middle" font-family="Arial,sans-serif" font-size="13" font-weight="bold" fill="#a7f3d0">Online フェーズ（推論時）</text>

  <!-- Q -->
  <rect x="465" y="105" width="70" height="60" rx="5" fill="#172554"/>
  <text x="500" y="125" text-anchor="middle" font-family="Arial,sans-serif" font-size="10" font-weight="bold" fill="#93c5fd">① クエリ</text>
  <text x="500" y="141" text-anchor="middle" font-family="Arial,sans-serif" font-size="9" fill="#60a5fa">ユーザーの</text>
  <text x="500" y="155" text-anchor="middle" font-family="Arial,sans-serif" font-size="9" fill="#60a5fa">質問文</text>
  <polygon points="538,135 550,131 550,139" fill="#059669"/>

  <!-- Embed Q -->
  <rect x="553" y="105" width="90" height="60" rx="5" fill="#064e3b"/>
  <text x="598" y="122" text-anchor="middle" font-family="Arial,sans-serif" font-size="10" font-weight="bold" fill="#6ee7b7">② Embedding</text>
  <text x="598" y="138" text-anchor="middle" font-family="Arial,sans-serif" font-size="9" fill="#34d399">クエリを</text>
  <text x="598" y="152" text-anchor="middle" font-family="Arial,sans-serif" font-size="9" fill="#34d399">ベクター化</text>
  <polygon points="646,135 658,131 658,139" fill="#059669"/>

  <!-- KNN -->
  <rect x="661" y="105" width="90" height="60" rx="5" fill="#78350f"/>
  <text x="706" y="122" text-anchor="middle" font-family="Arial,sans-serif" font-size="10" font-weight="bold" fill="#fde68a">③ KNN 検索</text>
  <text x="706" y="138" text-anchor="middle" font-family="Arial,sans-serif" font-size="9" fill="#fbbf24">コサイン類似度</text>
  <text x="706" y="152" text-anchor="middle" font-family="Arial,sans-serif" font-size="9" fill="#fbbf24">Top-K チャンク</text>
  <polygon points="754,135 766,131 766,139" fill="#059669"/>

  <!-- Augment -->
  <rect x="769" y="105" width="103" height="60" rx="5" fill="#3b0764"/>
  <text x="821" y="122" text-anchor="middle" font-family="Arial,sans-serif" font-size="10" font-weight="bold" fill="#c4b5fd">④ 拡張プロンプト</text>
  <text x="821" y="138" text-anchor="middle" font-family="Arial,sans-serif" font-size="9" fill="#a78bfa">クエリ+文書</text>
  <text x="821" y="152" text-anchor="middle" font-family="Arial,sans-serif" font-size="9" fill="#a78bfa">コンテキスト化</text>

  <!-- LLM + Answer -->
  <rect x="465" y="180" width="205" height="75" rx="6" fill="#1e1b4b"/>
  <text x="568" y="200" text-anchor="middle" font-family="Arial,sans-serif" font-size="11" font-weight="bold" fill="#a78bfa">⑤ LLM 生成</text>
  <text x="568" y="218" text-anchor="middle" font-family="Arial,sans-serif" font-size="10" fill="#8b5cf6">Claude / Titan 等が</text>
  <text x="568" y="234" text-anchor="middle" font-family="Arial,sans-serif" font-size="10" fill="#8b5cf6">取得文書を参考に回答</text>

  <rect x="680" y="180" width="192" height="75" rx="6" fill="#172554"/>
  <text x="776" y="200" text-anchor="middle" font-family="Arial,sans-serif" font-size="11" font-weight="bold" fill="#60a5fa">⑥ 根拠ある回答</text>
  <text x="776" y="218" text-anchor="middle" font-family="Arial,sans-serif" font-size="10" fill="#93c5fd">引用ソース付き</text>
  <text x="776" y="234" text-anchor="middle" font-family="Arial,sans-serif" font-size="10" fill="#93c5fd">ハルシネーション削減</text>

  <!-- Bedrock KB note -->
  <rect x="15" y="282" width="870" height="128" rx="8" fill="#0f172a"/>
  <text x="450" y="302" text-anchor="middle" font-family="Arial,sans-serif" font-size="12" font-weight="bold" fill="#fbbf24">Bedrock Knowledge Bases がこの全フローを自動実行</text>
  <rect x="30" y="315" width="265" height="80" rx="5" fill="#172554"/>
  <text x="163" y="335" text-anchor="middle" font-family="Arial,sans-serif" font-size="11" font-weight="bold" fill="#60a5fa">RetrieveAndGenerate API</text>
  <text x="163" y="353" text-anchor="middle" font-family="Arial,sans-serif" font-size="10" fill="#93c5fd">Offline + Online を1コールで完結</text>
  <text x="163" y="369" text-anchor="middle" font-family="Arial,sans-serif" font-size="10" fill="#93c5fd">Guardrailsとシームレスに統合</text>
  <text x="163" y="385" text-anchor="middle" font-family="Arial,sans-serif" font-size="9" fill="#475569">引用ソース (citations) も自動付与</text>
  <rect x="310" y="315" width="265" height="80" rx="5" fill="#3b0764"/>
  <text x="443" y="335" text-anchor="middle" font-family="Arial,sans-serif" font-size="11" font-weight="bold" fill="#c4b5fd">Retrieve API</text>
  <text x="443" y="353" text-anchor="middle" font-family="Arial,sans-serif" font-size="10" fill="#a78bfa">検索のみ（LLMは独自実装）</text>
  <text x="443" y="369" text-anchor="middle" font-family="Arial,sans-serif" font-size="10" fill="#a78bfa">フィルタリング・並べ替えが可能</text>
  <text x="443" y="385" text-anchor="middle" font-family="Arial,sans-serif" font-size="9" fill="#475569">返却: chunks + scores + metadata</text>
  <rect x="590" y="315" width="290" height="80" rx="5" fill="#064e3b"/>
  <text x="735" y="335" text-anchor="middle" font-family="Arial,sans-serif" font-size="11" font-weight="bold" fill="#6ee7b7">対応Vector DB</text>
  <text x="735" y="353" text-anchor="middle" font-family="Arial,sans-serif" font-size="10" fill="#34d399">OpenSearch Serverless / Pinecone</text>
  <text x="735" y="369" text-anchor="middle" font-family="Arial,sans-serif" font-size="10" fill="#34d399">Aurora PostgreSQL (pgvector)</text>
  <text x="735" y="385" text-anchor="middle" font-family="Arial,sans-serif" font-size="9" fill="#475569">MongoDB Atlas / Redis Enterprise</text>
</svg>

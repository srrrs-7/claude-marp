<svg viewBox="0 0 880 330" xmlns="http://www.w3.org/2000/svg" style="max-height:70vh;width:auto;display:block;margin:0 auto;letter-spacing:0;font-family:sans-serif">
  <!-- Title -->
  <text x="440" y="22" text-anchor="middle" font-size="15" font-weight="bold" fill="#333">分散学習の並列化戦略</text>

  <!-- Data Parallel -->
  <rect x="20" y="35" width="255" height="275" rx="10" fill="#e3f2fd" stroke="#1976d2" stroke-width="2"/>
  <text x="148" y="58" text-anchor="middle" font-size="13" font-weight="bold" fill="#1976d2">データ並列</text>
  <text x="148" y="74" text-anchor="middle" font-size="11" fill="#555">各GPUが同じモデルを保持</text>
  <!-- GPU boxes with different data shards -->
  <rect x="45" y="85" width="90" height="50" rx="6" fill="#1976d2"/>
  <text x="90" y="108" text-anchor="middle" font-size="12" fill="white">GPU 0</text>
  <text x="90" y="122" text-anchor="middle" font-size="10" fill="#bbdefb">データ 0-25%</text>
  <rect x="145" y="85" width="90" height="50" rx="6" fill="#1976d2"/>
  <text x="190" y="108" text-anchor="middle" font-size="12" fill="white">GPU 1</text>
  <text x="190" y="122" text-anchor="middle" font-size="10" fill="#bbdefb">データ 25-50%</text>
  <rect x="45" y="145" width="90" height="50" rx="6" fill="#1976d2"/>
  <text x="90" y="168" text-anchor="middle" font-size="12" fill="white">GPU 2</text>
  <text x="90" y="182" text-anchor="middle" font-size="10" fill="#bbdefb">データ 50-75%</text>
  <rect x="145" y="145" width="90" height="50" rx="6" fill="#1976d2"/>
  <text x="190" y="168" text-anchor="middle" font-size="12" fill="white">GPU 3</text>
  <text x="190" y="182" text-anchor="middle" font-size="10" fill="#bbdefb">データ 75-100%</text>
  <!-- All-reduce label -->
  <rect x="65" y="210" width="165" height="30" rx="6" fill="#bbdefb" stroke="#1976d2"/>
  <text x="148" y="229" text-anchor="middle" font-size="12" fill="#0d47a1">All-Reduce (勾配同期)</text>
  <text x="148" y="278" text-anchor="middle" font-size="11" fill="#555">✅ 実装容易 (DDP)</text>
  <text x="148" y="295" text-anchor="middle" font-size="11" fill="#555">⚠ モデル≦1GPU VRAM</text>

  <!-- Model Parallel -->
  <rect x="310" y="35" width="255" height="275" rx="10" fill="#f3e5f5" stroke="#7b1fa2" stroke-width="2"/>
  <text x="438" y="58" text-anchor="middle" font-size="13" font-weight="bold" fill="#7b1fa2">モデル並列</text>
  <text x="438" y="74" text-anchor="middle" font-size="11" fill="#555">モデルを複数GPUに分割</text>
  <!-- Model layers split across GPUs -->
  <rect x="335" y="85" width="205" height="40" rx="6" fill="#7b1fa2"/>
  <text x="438" y="110" text-anchor="middle" font-size="12" fill="white">GPU 0: Layer 1-4 (Embedding + Attn)</text>
  <line x1="438" y1="125" x2="438" y2="140" stroke="#7b1fa2" stroke-width="2"/>
  <polygon points="432,137 438,147 444,137" fill="#7b1fa2"/>
  <rect x="335" y="145" width="205" height="40" rx="6" fill="#9c27b0"/>
  <text x="438" y="170" text-anchor="middle" font-size="12" fill="white">GPU 1: Layer 5-8 (FFN + Attn)</text>
  <line x1="438" y1="185" x2="438" y2="200" stroke="#7b1fa2" stroke-width="2"/>
  <polygon points="432,197 438,207 444,197" fill="#7b1fa2"/>
  <rect x="335" y="205" width="205" height="40" rx="6" fill="#ab47bc"/>
  <text x="438" y="230" text-anchor="middle" font-size="12" fill="white">GPU 2: Layer 9-12 (Output)</text>
  <text x="438" y="278" text-anchor="middle" font-size="11" fill="#555">✅ 超大型モデル対応</text>
  <text x="438" y="295" text-anchor="middle" font-size="11" fill="#555">⚠ バブル問題発生</text>

  <!-- Pipeline Parallel -->
  <rect x="600" y="35" width="255" height="275" rx="10" fill="#e8f5e9" stroke="#388e3c" stroke-width="2"/>
  <text x="728" y="58" text-anchor="middle" font-size="13" font-weight="bold" fill="#388e3c">パイプライン並列</text>
  <text x="728" y="74" text-anchor="middle" font-size="11" fill="#555">マイクロバッチで重複実行</text>
  <!-- Pipeline timing diagram -->
  <!-- GPU 0 -->
  <text x="625" y="100" font-size="11" fill="#388e3c">GPU0</text>
  <rect x="645" y="88" width="45" height="20" rx="3" fill="#388e3c"/>
  <text x="668" y="102" text-anchor="middle" font-size="10" fill="white">μ1</text>
  <rect x="695" y="88" width="45" height="20" rx="3" fill="#81c784"/>
  <text x="718" y="102" text-anchor="middle" font-size="10" fill="white">μ2</text>
  <rect x="745" y="88" width="45" height="20" rx="3" fill="#a5d6a7"/>
  <text x="768" y="102" text-anchor="middle" font-size="10" fill="#333">μ3</text>
  <!-- GPU 1 -->
  <text x="625" y="130" font-size="11" fill="#388e3c">GPU1</text>
  <rect x="695" y="118" width="45" height="20" rx="3" fill="#388e3c"/>
  <text x="718" y="132" text-anchor="middle" font-size="10" fill="white">μ1</text>
  <rect x="745" y="118" width="45" height="20" rx="3" fill="#81c784"/>
  <text x="768" y="132" text-anchor="middle" font-size="10" fill="white">μ2</text>
  <!-- GPU 2 -->
  <text x="625" y="160" font-size="11" fill="#388e3c">GPU2</text>
  <rect x="745" y="148" width="45" height="20" rx="3" fill="#388e3c"/>
  <text x="768" y="162" text-anchor="middle" font-size="10" fill="white">μ1</text>
  <!-- Bubble annotation -->
  <rect x="645" y="118" width="45" height="20" rx="3" fill="#ffcdd2" stroke="#e53935" stroke-dasharray="3,2"/>
  <text x="668" y="132" text-anchor="middle" font-size="9" fill="#c62828">bubble</text>
  <!-- GPipe / 1F1B -->
  <text x="728" y="200" text-anchor="middle" font-size="11" fill="#555">GPipe / 1F1B スケジューリング</text>
  <text x="728" y="278" text-anchor="middle" font-size="11" fill="#555">✅ バブル軽減 + 大規模</text>
  <text x="728" y="295" text-anchor="middle" font-size="11" fill="#555">⚠ 実装・調整が複雑</text>
</svg>

---
marp: true
theme: gaia
class: invert
size: 16:9
paginate: true
header: "カオス理論とソフトウェアバグ"
footer: "© 2026"
style: |
  section pre code { font-size: 0.58em; line-height: 1.4; }
  
---

<!-- _class: lead -->
# カオス理論とバグ

- バタフライ効果と本番障害の因果連鎖
- 決定論的システムの予測不可能性
- なぜ「再現しないバグ」が存在するか


---

# アジェンダ

- 1. カオス理論とは何か
- 2. バタフライ効果の数学
- 3. ソフトウェアにおけるカオス
- 4. 再現しないバグの本質
- 5. カオスエンジニアリングへの応用


---

<!-- _class: lead -->
# カオス理論の誕生


---

# 1961年：ローレンツの偶然の発見

- 気象学者 Edward Lorenz が気象シミュレーションを再実行
- **途中から再開するために小数点以下を丸めた：**
- 0.506127 → 0.506（0.02%の差）
- ---
- **2ヶ月後の予測が完全に異なる結果になった**
- 
- この発見が「カオス理論」の出発点
- → **初期条件のわずかな差が、最終結果に指数関数的な差をもたらす**


---

# バタフライ効果の数式的な理解

- ローレンツ方程式（大幅に簡略化）：
- 
- 誤差の成長：δ(t) = δ₀ × e^(λt)
- 
- λ（リアプノフ指数）> 0 のとき → 初期誤差が指数関数的に拡大
- ---
- **具体例：** λ = 1 の場合
- - t=1 : 誤差は e倍（2.7倍）
- - t=10 : 誤差は e¹⁰倍（22,026倍）
- - t=100 : 天文学的な差に
- → 長期予測は原理的に不可能


---

<!-- _class: lead -->
# ソフトウェアにおけるカオス


---

# 「再現しないバグ」の正体

- 「手元では再現しない」バグの多くはカオス的な原因を持つ：
- ---
- **1. タイミング依存（レースコンディション）**
- CPUスケジューリングのマイクロ秒の差が結果を決定する
- 
- **2. メモリレイアウトの非決定性**
- ASLR（Address Space Layout Randomization）で毎回アドレスが変わる
- 
- **3. 浮動小数点の丸め誤差**
- 最適化レベルで計算順序が変わり結果が異なる
- 
- **4. 外部状態の依存**
- ネットワーク遅延・時計・環境変数・ファイルシステムの状態


---

# バタフライ効果が起きた本番障害の実例

- **事例：Amazon S3の2017年障害**
- 原因：デバッグコマンドの入力ミス（引数を1つ多く指定）
- 影響：大量のサーバーが予期せず再起動 → 数時間のダウン
- 被害：推定1.5億ドル/時間
- ---
- **事例：Cloudflare 2019年障害**
- 原因：正規表現のバックトラッキング（Re2DoS）
- 影響：CPU使用率100% → 全サービスダウン 27分
- → 微小な変更が全体に伝播するカオス的なシステム


---

<!-- _class: lead -->
# カオスエンジニアリング


---

# カオスモンキー：意図的に障害を起こす

- Netflix が2011年に開発したカオスエンジニアリングツール
- ---
- **哲学：** 本番環境で偶発的に起きる障害なら、
- 意図的に制御された形で先に経験した方が安全
- ---
- **Simian Army の種類：**
- - Chaos Monkey：ランダムにサーバーを強制終了
- - Latency Monkey：ネットワーク遅延を注入
- - Conformity Monkey：設定違反のインスタンスを検出
- - Security Monkey：セキュリティグループの異常を検出


---

# カオスを「設計」する

| カオス理論の概念 | エンジニアリングの対応 |
|:---|:---|
| 初期条件の感度 | 入力バリデーションの徹底 |
| ストレンジアトラクタ | 定常状態の監視 |
| リアプノフ指数 | エラーレートの監視 |
| バタフライ効果 | 変更管理・Feature Flag |
| カオスの縁 | キャパシティプランニング |


---

# まとめ：カオスと共存する設計

- ✅ **決定論的なシステムでも長期予測は不可能**
- ✅ **「再現しないバグ」はバグではなくカオスの証拠**
- ✅ **冪等性の設計** — 何度実行しても同じ結果になるように
- ✅ **観測可能性（Observability）** — カオスを「見える化」する
- ✅ **意図的な障害注入** — 制御されたカオスで予期せぬカオスに備える
- 
- 「制御できないなら、観察することが唯一の武器だ」


---
marp: true
theme: gaia
size: 16:9
paginate: true
---

<!-- _class: lead -->
# AWS ストレージサービス完全ガイド

- S3・EBS・EFS・FSx・Storage Gateway
- 設計パターンとベストプラクティス
- 2026年2月版


---

# 目次（1/2）

- **1. Amazon S3** — オブジェクトストレージの基礎と応用
- **2. Amazon EBS** — ブロックストレージとボリューム設計
- **3. Amazon EFS** — マネージドファイルシステム
- **4. Amazon FSx** — 高性能ファイルシステム群
- **5. AWS Storage Gateway** — ハイブリッドストレージ


---

# 目次（2/2）

- **6. データ移行サービス** — Snow Family・DataSync・Transfer Family
- **7. バックアップと災害復旧** — AWS Backup・設計戦略
- **8. ストレージ設計パターン** — ユースケース別アーキテクチャ
- **9. コスト最適化** — ライフサイクル管理と料金比較
- **10. まとめ** — サービス選定フローチャート


---

<!-- _class: lead -->
# Amazon S3

- オブジェクトストレージの基礎と応用


---

# S3 概要

- **イレブンナイン (99.999999999%) の耐久性**を提供するオブジェクトストレージ
- - 無制限のスケーラビリティ（オブジェクト数・容量に制限なし）
- - 単一オブジェクトの最大サイズ: **5 TB**
- - RESTful API（PUT/GET/DELETE）によるアクセス
- - イベント通知（Lambda・SNS・SQS・EventBridge連携）
- - サーバーレスアーキテクチャの中核データストア

<!--
S3は2006年のリリース以降、AWSで最も利用されるサービスの一つ。耐久性のイレブンナインは設計上の保証値。
-->

---

# S3 ストレージクラス（1/2）

| クラス | 用途 | 可用性 | 最低保存期間 |
|--------|------|--------|-------------|
| **S3 Standard** | 頻繁アクセス | 99.99% | なし |
| **S3 Intelligent-Tiering** | アクセス頻度不明 | 99.9% | なし |
| **S3 Standard-IA** | 低頻度アクセス | 99.9% | 30日 |
| **S3 One Zone-IA** | 低頻度・単一AZ | 99.5% | 30日 |

<!--
Intelligent-Tieringはモニタリング料金が発生するが、自動的に最適なクラスに移動してくれる。
-->

---

# S3 ストレージクラス（2/2）

| クラス | 用途 | 可用性 | 最低保存期間 |
|--------|------|--------|-------------|
| **S3 Glacier Instant Retrieval** | アーカイブ（即時取得） | 99.9% | 90日 |
| **S3 Glacier Flexible Retrieval** | アーカイブ（数分〜数時間） | 99.99% | 90日 |
| **S3 Glacier Deep Archive** | 長期アーカイブ | 99.99% | 180日 |
- 
- **コスト傾向**: Standard → Glacier Deep Archive で保存コストが最大**95%削減**

<!--
Deep Archiveは取得に最大12時間かかるが、テープバックアップの代替として非常に安価。
-->

---

# S3 バケットポリシーとアクセス制御

- **4つのアクセス制御メカニズム:**
- - **IAM ポリシー** — ユーザー/ロール単位の権限管理
- - **バケットポリシー** — バケット単位のリソースベースポリシー
- - **ACL** — レガシー（非推奨、無効化を推奨）
- - **S3 Access Points** — アプリケーション別のアクセスエンドポイント
- 
- **推奨**: ACLを無効化し、IAMポリシー + バケットポリシーで管理

<!--
2023年4月以降、新規バケットはデフォルトでACLが無効化されている。
-->

---

# S3 バケットポリシー例

- 特定VPCエンドポイントからのアクセスのみ許可する例:

```json
{
  "Version": "2012-10-17",
  "Statement": [{
    "Sid": "VPCEndpointOnly",
    "Effect": "Deny",
    "Principal": "*",
    "Action": "s3:*",
    "Resource": [
      "arn:aws:s3:::my-bucket",
      "arn:aws:s3:::my-bucket/*"
    ],
    "Condition": {
      "StringNotEquals": {
        "aws:sourceVpce": "vpce-1234567890"
      }
    }
  }]
}
```


---

# S3 暗号化オプション

- **サーバーサイド暗号化（SSE）:**
- - **SSE-S3** — S3管理キー（デフォルト・追加料金なし）
- - **SSE-KMS** — AWS KMS管理キー（監査証跡・キーローテーション）
- - **SSE-C** — 顧客提供キー（キー管理は利用者責任）
- - **DSSE-KMS** — 二重暗号化（コンプライアンス要件向け）
- 
- **クライアントサイド暗号化**: アップロード前にクライアント側で暗号化

<!--
2023年1月以降、すべての新規オブジェクトにSSE-S3がデフォルトで適用される。
-->

---

# S3 バージョニングとライフサイクル

- **バージョニング:**
- - オブジェクトの全バージョンを保持（誤削除からの復旧）
- - 削除マーカーによる論理削除
- - MFA Delete で誤削除を防止
- 
- **ライフサイクルルール:**
- - 日数ベースでストレージクラスを自動遷移
- - 旧バージョンの自動削除
- - 不完全なマルチパートアップロードのクリーンアップ


---

# S3 ライフサイクルポリシー例

- 段階的にコストを最適化するライフサイクル設定:

```json
{
  "Rules": [{
    "ID": "OptimizeCost",
    "Status": "Enabled",
    "Transitions": [
      { "Days": 30, "StorageClass": "STANDARD_IA" },
      { "Days": 90, "StorageClass": "GLACIER" },
      { "Days": 365, "StorageClass": "DEEP_ARCHIVE" }
    ],
    "NoncurrentVersionExpiration": {
      "NoncurrentDays": 90
    }
  }]
}
```


---

# S3 レプリケーション

- **クロスリージョンレプリケーション（CRR）:**
- - 災害復旧（DR）のためのリージョン間複製
- - コンプライアンス要件（データの地理的冗長性）
- 
- **同一リージョンレプリケーション（SRR）:**
- - ログの集約（複数アカウント → 単一バケット）
- - 本番/テスト環境間のデータ同期
- 
- **前提条件**: 送信元・送信先ともにバージョニング有効化が必須


---

# S3 パフォーマンス最適化

- **ベースラインパフォーマンス:**
- - プレフィックスあたり **3,500 PUT/s** + **5,500 GET/s**
- - プレフィックス分散でスループットを線形スケール
- 
- **高速化オプション:**
- - **S3 Transfer Acceleration** — CloudFrontエッジ経由でアップロード高速化
- - **マルチパートアップロード** — 100MB以上のファイルで推奨（5GB以上で必須）
- - **S3 Select / Glacier Select** — サーバーサイドでCSV/JSONをフィルタリング

<!--
プレフィックスの分散設計により、理論上無制限のスループットを達成可能。
-->

---

# S3 イベント通知と連携

- **S3 Event Notifications:**
- - オブジェクトの作成・削除・復元をトリガー
- - 送信先: **Lambda** / **SQS** / **SNS** / **EventBridge**
- 
- **主なユースケース:**
- - 画像アップロード → Lambda でサムネイル生成
- - ログファイル配置 → SQS 経由でバッチ処理
- - データ到着 → EventBridge で複数サービスにファンアウト


---

# S3 セキュリティベストプラクティス

- **必須設定:**
- - **S3 Block Public Access** を有効化（アカウントレベル推奨）
- - **デフォルト暗号化** を有効化（SSE-S3 or SSE-KMS）
- - **アクセスログ** を有効化（監査証跡）
- 
- **推奨設定:**
- - **Object Lock** でWORM準拠（コンプライアンス要件）
- - **VPCエンドポイント** 経由でプライベートアクセス
- - **Macie** でPII/機密データの自動検出


---

# S3 料金体系

- **課金要素（5つ）:**
- - **ストレージ容量** — GB/月単位（クラスにより異なる）
- - **リクエスト数** — PUT/GET/LIST等のAPI呼び出し
- - **データ転送** — リージョン外への送信（S3→インターネット）
- - **管理機能** — Inventory・Analytics・Intelligent-Tiering監視
- - **レプリケーション** — CRR/SRRの転送・ストレージ

<!--
同一リージョン内のEC2からS3へのアクセスは転送料金無料。CloudFront経由も送信コスト削減に有効。
-->

---

# S3 まとめ

- - **イレブンナイン耐久性**の信頼性の高いオブジェクトストレージ
- - **8つのストレージクラス**でコストを最適化
- - **暗号化・アクセス制御・監査**の多層セキュリティ
- - **イベント駆動**でサーバーレスアーキテクチャと統合
- - **レプリケーション**でDR・コンプライアンスに対応
- - AWSサービスの**データレイク基盤**として最も採用される


---

<!-- _class: lead -->
# Amazon EBS

- ブロックストレージとボリューム設計


---

# EBS 概要

- EC2インスタンスにアタッチする**ネットワーク接続型ブロックストレージ**
- - 単一AZ内で自動的に複製（高可用性）
- - インスタンスから独立したライフサイクル（停止/終了後もデータ保持可能）
- - スナップショットによるポイントインタイムバックアップ
- - 暗号化（AES-256）をワンクリックで有効化
- - 同一AZ内の**複数EC2へのマルチアタッチ**をサポート（io1/io2）

<!--
EBSはネットワーク越しに接続されるため、インスタンスストアと比べてわずかにレイテンシがある。ただし永続性と柔軟性で優れる。
-->

---

# EBS ボリュームタイプ一覧

| タイプ | 名称 | IOPS上限 | スループット | 用途 |
|--------|------|---------|-------------|------|
| **gp3** | 汎用SSD | 16,000 | 1,000 MB/s | 一般ワークロード |
| **gp2** | 汎用SSD | 16,000 | 250 MB/s | レガシー（gp3推奨） |
| **io2 BE** | プロビジョンドSSD | 256,000 | 4,000 MB/s | ミッションクリティカルDB |
| **st1** | スループットHDD | 500 | 500 MB/s | ビッグデータ・ログ |
| **sc1** | コールドHDD | 250 | 250 MB/s | アーカイブ |


---

# gp3 vs gp2 比較

- **gp3（推奨）:**
- - ベースライン: **3,000 IOPS** + **125 MB/s**（追加料金なし）
- - IOPS・スループットを**独立してプロビジョニング**可能
- - gp2と比べて最大**20%コスト削減**
- 
- **gp2（レガシー）:**
- - ボリュームサイズに比例してIOPSが自動決定（3 IOPS/GiB）
- - バーストクレジット方式（小容量で一時的にIOPS向上）
- - 新規作成はgp3への移行を推奨

<!--
既存のgp2ボリュームもオンラインでgp3に変更可能。ダウンタイム不要。
-->

---

# io2 Block Express

- **最高性能のEBSボリューム:**
- - 最大 **256,000 IOPS**（io1の4倍）
- - 最大 **4,000 MB/s** スループット
- - サブミリ秒レイテンシ
- - **64 TiB** の最大ボリュームサイズ
- 
- **ユースケース:**
- - SAP HANA、Oracle、SQL Serverなどの大規模データベース
- - レイテンシに敏感なトランザクション処理


---

# EBS スナップショット

- **特徴:**
- - **増分バックアップ** — 変更ブロックのみ保存（コスト効率）
- - S3に保存（リージョン内で冗長化）
- - 別AZ・別リージョンへのコピーが可能
- 
- **運用のポイント:**
- - スナップショット中もボリュームは利用可能
- - **EBS Snapshots Archive** で最大75%コスト削減（取得に24-72時間）
- - **ゴミ箱（Recycle Bin）** で誤削除からの復元が可能


---

# EBS スナップショット運用例

- AWS CLIを使用した自動スナップショット取得:

```bash
# スナップショット作成
aws ec2 create-snapshot \
  --volume-id vol-0123456789abcdef0 \
  --description "Daily backup $(date +%Y-%m-%d)" \
  --tag-specifications 'ResourceType=snapshot,Tags=[{Key=Name,Value=daily-backup}]'

# 古いスナップショットの削除（30日以上前）
aws ec2 describe-snapshots \
  --filters Name=tag:Name,Values=daily-backup \
  --query 'Snapshots[?StartTime<=`2026-01-15`].SnapshotId' \
  --output text | xargs -n1 aws ec2 delete-snapshot --snapshot-id
```


---

# EBS 暗号化

- **暗号化の仕組み:**
- - AES-256暗号化（AWS KMSキーを使用）
- - ボリューム・スナップショット・転送中データすべてを暗号化
- - EC2インスタンス側でのパフォーマンス影響は**ほぼゼロ**
- 
- **ベストプラクティス:**
- - **アカウントレベルでデフォルト暗号化を有効化**
- - 非暗号化ボリューム → スナップショット → 暗号化コピー → 新ボリューム作成で移行
- - カスタムKMSキーで監査・ローテーション管理


---

# EBS マルチアタッチ

- **io1/io2 ボリュームで利用可能:**
- - 同一AZ内の**最大16個のEC2インスタンス**に同時アタッチ
- - 各インスタンスがフル読み書き権限を保持
- 
- **制約事項:**
- - Nitroベースのインスタンスのみサポート
- - クラスタ対応ファイルシステムが必要（ext4/xfs不可）
- - 同一AZ内のみ（クロスAZ不可）
- 
- **ユースケース**: クラスタ化されたDB、高可用性アプリケーション


---

# EBS パフォーマンスチューニング

- **EBS最適化インスタンス:**
- - 専用帯域幅でEBSトラフィックを分離
- - 現行世代のインスタンスはデフォルトで有効
- 
- **IOPSの考え方:**
- - gp3: ベースライン3,000 → 最大16,000（追加課金）
- - io2: GiBあたり最大500 IOPSをプロビジョニング
- - **I/Oサイズ**: 16KiB以下は1 IOPS、256KiBは16 IOPS消費
- 
- **監視**: CloudWatch `VolumeReadOps` / `VolumeWriteOps` メトリクスを活用


---

# EBS 料金体系

- **課金要素:**
- - **プロビジョニング容量** — GiB/月単位
- - **プロビジョニングIOPS** — io1/io2のIOPS課金
- - **スループット** — gp3の追加スループット課金
- - **スナップショット** — S3保存量に基づく課金
- 
- **コスト最適化のヒント:**
- - gp2 → gp3への移行で約20%削減
- - 未使用ボリュームの定期的な棚卸し
- - スナップショットのライフサイクル管理（DLM活用）

<!--
AWS Data Lifecycle Manager (DLM) でスナップショットの作成・保持・削除を自動化できる。
-->

---

# EBS まとめ

- - EC2向け**高性能ブロックストレージ**（SSD/HDD選択可能）
- - **gp3が標準推奨**（コスト効率・独立したIOPS設定）
- - **io2 Block Express**で最大256K IOPSの超高性能
- - **増分スナップショット**で効率的なバックアップ
- - **暗号化はデフォルト有効化**を推奨
- - **マルチアタッチ**でHA構成をサポート（io1/io2）


---

<!-- _class: lead -->
# Amazon EFS

- マネージドファイルシステム


---

# EFS 概要

- **フルマネージドNFSv4ファイルシステム**（Linux向け）
- - 複数のEC2・ECS・Lambda から**同時マウント**可能
- - **ペタバイト規模**まで自動スケール（容量の事前プロビジョニング不要）
- - 3つ以上のAZにデータを自動複製（高可用性・高耐久性）
- - POSIX準拠のファイルシステムセマンティクス
- - NFSv4.0 / NFSv4.1 プロトコルをサポート

<!--
EFSはEBSと異なり、複数インスタンスから同時アクセスできるため、共有ストレージのユースケースに最適。Windowsの場合はFSx for Windows File Serverを使用する。
-->

---

# EFS ストレージクラス

| クラス | 用途 | 可用性 | コスト |
|--------|------|--------|--------|
| **Standard** | 頻繁アクセス | マルチAZ | 高 |
| **Standard-IA** | 低頻度アクセス | マルチAZ | 低（アクセス課金あり） |
| **One Zone** | 頻繁アクセス（単一AZ） | シングルAZ | 中 |
| **One Zone-IA** | 低頻度（単一AZ） | シングルAZ | 最低 |
- 
- **EFS Intelligent-Tiering** でアクセスパターンに応じて自動移行

<!--
One Zoneクラスは開発環境やバックアップ用途に適している。本番環境ではマルチAZのStandardを推奨。
-->

---

# EFS パフォーマンスモード

- **スループットモード:**
- - **Elastic（推奨）** — ワークロードに応じて自動スケール（最大10 GiB/s読取）
- - **Provisioned** — スループットを固定でプロビジョニング
- - **Bursting** — ファイルシステムサイズに比例（レガシー）
- 
- **パフォーマンスモード:**
- - **汎用（General Purpose）** — レイテンシ重視（推奨）
- - **最大I/O（Max I/O）** — スループット重視（数千クライアント同時接続時）

<!--
Elasticスループットモードは2022年に追加された比較的新しいモード。ほとんどのワークロードでElasticが最適。
-->

---

# EFS マウント設定例

- EC2インスタンスからEFSをマウントする手順:

```bash
# EFS マウントヘルパーをインストール
sudo yum install -y amazon-efs-utils

# マウントポイント作成
sudo mkdir -p /mnt/efs

# TLS暗号化付きでマウント（推奨）
sudo mount -t efs -o tls fs-0123456789abcdef0:/ /mnt/efs

# /etc/fstab に永続マウント設定
echo 'fs-0123456789abcdef0:/ /mnt/efs efs _netdev,tls 0 0' \
  | sudo tee -a /etc/fstab
```


---

# EFS アクセス制御

- **ネットワークアクセス:**
- - **マウントターゲット** — 各AZにENIを配置（セキュリティグループで制御）
- - **VPC内アクセスのみ**（デフォルト）、VPN/Direct Connect経由でオンプレ接続可
- 
- **ファイルシステムアクセス:**
- - **EFS アクセスポイント** — アプリケーション別のアクセスエンドポイント
- - POSIX ユーザー/グループによるアクセス制御
- - **IAM認証** でマウント権限をポリシーベースで管理
- - **リソースベースポリシー** でクロスアカウントアクセスを制御


---

# EFS + Lambda 連携

- **Lambda関数からEFSをマウント:**
- - Lambda関数をVPC内に配置
- - EFSアクセスポイント経由でファイルシステムを接続
- - `/mnt/` パスでファイルの読み書きが可能
- 
- **ユースケース:**
- - 大容量の機械学習モデルの共有（数GB〜数百GB）
- - 複数Lambda間でのファイルベース処理パイプライン
- - `/tmp`（最大10GB）を超える一時ファイル処理

<!--
Lambda + EFSの組み合わせは2020年に追加された機能。ML推論でモデルファイルを共有するパターンが増えている。
-->

---

# EFS 暗号化・バックアップ・料金

- **暗号化:** 保存時（KMS）+ 転送時（TLS）の二重暗号化
- **バックアップ:** AWS Backup統合 + クロスリージョンレプリケーション（RPO 15分）
- 
- **課金要素:**
- - ストレージ容量（GB/月）+ IAアクセス料金 + スループット課金
- 
- **コスト最適化:**
- - **Intelligent-Tiering** でIAクラスに自動移行（最大92%削減）
- - **One Zone** クラスで約47%削減（開発環境向け）

<!--
EFS Standard: 約0.30 USD/GB/月、EFS Standard-IA: 約0.016 USD/GB/月と大きな価格差がある。保存時暗号化はFS作成時のみ有効化可能。
-->

---

# EFS まとめ

- - **フルマネージドNFS**で複数インスタンスからの共有アクセスに最適
- - **ペタバイト規模**まで自動スケール（容量管理不要）
- - **Elastic スループット**でパフォーマンスを自動調整
- - **Lambda・ECS・EKS** とのネイティブ統合
- - **Intelligent-Tiering** でストレージコストを最大92%削減
- - **クロスリージョンレプリケーション** でDR対応


---

<!-- _class: lead -->
# Amazon FSx

- 高性能ファイルシステム群


---

# FSx ファミリー概要

- **4つのフルマネージドファイルシステム:**
- - **FSx for Windows File Server** — Windows SMB共有（AD統合）
- - **FSx for Lustre** — HPC・ML向け超高性能並列FS
- - **FSx for NetApp ONTAP** — マルチプロトコル（NFS/SMB/iSCSI）
- - **FSx for OpenZFS** — ZFSベース（高スループット・スナップショット）
- 
- **共通の特徴**: フルマネージド・暗号化・バックアップ・高可用性

<!--
FSxファミリーはそれぞれ異なるユースケースに特化している。既存のファイルシステムからの移行を簡単にするためにネイティブ互換性を提供。
-->

---

# FSx for Windows File Server

- **Windows環境向けフルマネージドSMBファイル共有:**
- - **Active Directory統合** — AWS Managed ADまたはオンプレADと連携
- - **SMB 2.0〜3.1.1** プロトコル対応
- - DFS名前空間・DFSレプリケーション対応
- - **VSS（Volume Shadow Copy）** によるエンドユーザーファイル復元
- 
- **パフォーマンス:**
- - SSD: 最大 **200,000 IOPS**、HDD: コスト効率重視
- - マルチAZ構成で自動フェイルオーバー（高可用性）


---

# FSx for Lustre

- **HPC・機械学習向け超高性能並列ファイルシステム:**
- - 数百 GB/s のスループットと数百万 IOPS
- - サブミリ秒レイテンシ
- - **S3とのシームレス統合** — S3バケットをデータレポジトリとしてリンク
- 
- **デプロイメントタイプ:**
- - **Persistent** — 長期保存（マルチAZ複製）、本番ワークロード向け
- - **Scratch** — 一時的処理（高スループット・低コスト）、バッチ処理向け

<!--
LustreはLinux + Clusterの造語。HPCの分野で広く使われているオープンソースファイルシステム。
-->

---

# FSx for Lustre + S3 連携

- **S3データレポジトリ連携の仕組み:**
- - FSx作成時にS3バケットをリンク
- - S3オブジェクトがFSx上に**メタデータとして自動表示**
- - **初回アクセス時にS3からデータを自動取得**（Lazy Loading）
- - 処理結果をS3に**自動エクスポート**可能
- 
- **パターン: S3 → FSx(Lustre) → 高速処理 → S3**
- - ML学習データをS3に保存 → Lustreで高速読み込み → 結果をS3にエクスポート


---

# FSx for NetApp ONTAP

- **NetApp ONTAPベースのマルチプロトコルファイルシステム:**
- - **NFS / SMB / iSCSI** を同時サポート（Linux・Windows・macOS対応）
- - **SnapMirror** でクロスリージョン/オンプレとのレプリケーション
- - **FlexClone** でスペース効率の高いクローン（開発・テスト環境）
- - データ圧縮・重複排除・コンパクション対応
- 
- **ユースケース:**
- - オンプレNAS/SANからの移行、マルチOS環境の共有ストレージ

<!--
NetApp ONTAPは企業で広く使われているストレージOS。既存のNetApp環境からの移行が容易。
-->

---

# FSx for OpenZFS

- **ZFSベースの高性能ファイルシステム:**
- - 最大 **12.5 GB/s** のスループットと最大 **100万 IOPS**
- - NFS（v3, v4, v4.1, v4.2）プロトコル対応
- - **即時スナップショット** — ゼロコストのポイントインタイムコピー
- - **データクローニング** — 秒単位でボリューム複製
- - LZ4 / Zstandard によるインライン圧縮
- 
- **ユースケース:** Linux/macOSベースのNAS移行、データベース、CI/CDビルド環境


---

# FSx ファミリー選定ガイド

| 要件 | 推奨FSx |
|------|---------|
| Windows SMB + AD統合 | **FSx for Windows** |
| HPC / ML高速処理 | **FSx for Lustre** |
| マルチプロトコル (NFS+SMB+iSCSI) | **FSx for NetApp ONTAP** |
| ZFS互換 / 高速スナップショット | **FSx for OpenZFS** |
| オンプレNAS移行（NetApp既存） | **FSx for NetApp ONTAP** |
| S3データの高速バッチ処理 | **FSx for Lustre** |


---

# FSx まとめ

- - **4つの専用ファイルシステム**で多様なワークロードに対応
- - **Windows環境** → FSx for Windows（AD統合・SMB）
- - **HPC/ML** → FSx for Lustre（S3連携・超高スループット）
- - **マルチプロトコル** → FSx for NetApp ONTAP（NFS/SMB/iSCSI）
- - **ZFS互換** → FSx for OpenZFS（スナップショット・高速I/O）
- - すべてフルマネージド・暗号化・自動バックアップ対応


---

<!-- _class: lead -->
# AWS Storage Gateway

- ハイブリッドストレージ


---

# Storage Gateway 概要

- **オンプレミスとAWSクラウドを接続するハイブリッドストレージサービス**
- - オンプレにゲートウェイVM（またはハードウェアアプライアンス）を配置
- - 標準プロトコル（NFS/SMB/iSCSI）でアクセス
- - バックエンドでS3・EBS・Glacierにデータを自動保存
- - **ローカルキャッシュ**で低レイテンシアクセスを維持
- - オンプレからクラウドへの段階的移行に最適

<!--
Storage GatewayはVMware ESXi、Microsoft Hyper-V、KVMで動作。AWSが提供するハードウェアアプライアンスも選択可能。
-->

---

# Storage Gateway タイプ一覧

| タイプ | プロトコル | バックエンド | 用途 |
|--------|-----------|-------------|------|
| **S3 File Gateway** | NFS / SMB | S3 | ファイル共有のクラウド拡張 |
| **FSx File Gateway** | SMB | FSx for Windows | Windows共有のキャッシュ |
| **Volume Gateway** | iSCSI | S3 + EBS | ブロックストレージ |
| **Tape Gateway** | iSCSI (VTL) | S3 Glacier | テープバックアップ代替 |


---

# S3 File Gateway

- **NFS/SMBプロトコルでS3バケットにアクセス:**
- - ファイル → S3オブジェクトに1:1マッピング
- - オンプレアプリからは通常のファイル共有として見える
- - **ローカルキャッシュ**で頻繁アクセスデータを高速提供
- 
- **主なユースケース:**
- - オンプレファイルサーバーのクラウド移行
- - データレイクへのデータ取り込みパイプライン
- - バックアップデータのS3保存（ライフサイクルでGlacierに自動移行）


---

# Volume Gateway

- **iSCSIプロトコルでブロックストレージを提供:**
- 
- **Cached Volumes（キャッシュモード）:**
- - データ本体はS3に保存、頻繁アクセスデータのみローカルキャッシュ
- - 最大 **1 PB**（32ボリューム × 32 TiB）
- 
- **Stored Volumes（保存モード）:**
- - データ本体はオンプレに保存、S3に非同期バックアップ
- - 最大 **512 TiB**（32ボリューム × 16 TiB）
- 
- **EBSスナップショットとして復元可能** → クラウドへのDR対応

<!--
Cached Volumesはクラウドファースト、Stored Volumesはオンプレファーストのアプローチ。移行計画に応じて選択する。
-->

---

# Tape Gateway

- **既存のバックアップソフトウェアとテープワークフローをクラウド化:**
- - **仮想テープライブラリ（VTL）** としてiSCSI経由で接続
- - バックアップソフト（Veeam・Veritas・Commvault等）とネイティブ連携
- - 仮想テープ → S3に保存 → アーカイブ時にGlacier/Deep Archiveへ自動移行
- 
- **メリット:**
- - 既存のバックアップ運用フローを変更不要
- - 物理テープの管理・保管・輸送コストを排除
- - テープあたり最大 **5 TiB**、ライブラリあたり最大 **1,500** テープ


---

# Storage Gateway デプロイと運用

- **デプロイオプション:**
- - **VM アプライアンス** — VMware ESXi / Hyper-V / KVM（4 vCPU, 16GB RAM）
- - **ハードウェアアプライアンス** — AWS提供1Uサーバー（仮想化環境不要時）
- - **EC2ゲートウェイ** — クラウド内ワークロード・DRテスト向け
- 
- **まとめ:**
- - **標準プロトコル**（NFS/SMB/iSCSI）で既存アプリとの互換性を維持
- - ローカルキャッシュで**低レイテンシ**を確保
- - オンプレからクラウドへの**段階的移行**に最適


---

# AWS Snow Family

- **大容量データのオフライン移行デバイス群:**
- - **Snowcone** — 8TB HDD / 14TB SSD、軽量2.1kg、エッジコンピューティング対応
- - **Snowball Edge Storage Optimized** — 80TB、S3互換エンドポイント搭載
- - **Snowball Edge Compute Optimized** — 42TB + 52 vCPU、EC2/Lambda実行可能
- - **Snowmobile** — 100PB、45フィートコンテナトラックで超大規模移行
- 
- **共通**: 暗号化（256bit）・耐衝撃・耐改ざん設計、AWS OpsHubで管理

<!--
ネットワーク転送に1週間以上かかる場合はSnow Familyが費用対効果で優位。Snowmobileは10PB以上の移行で推奨。
-->

---

# AWS DataSync & Transfer Family

- **AWS DataSync:**
- - オンプレ ↔ AWS 間のデータ転送を**自動化・高速化**
- - NFS / SMB / HDFS / S3 / EFS / FSx に対応
- - 帯域制限・スケジュール実行・増分転送・データ検証
- 
- **AWS Transfer Family:**
- - **SFTP / FTPS / FTP / AS2** プロトコルでS3・EFSにアクセス
- - 既存のファイル転送ワークフローをそのままクラウドに移行
- - IDプロバイダ統合（AD・LDAP・カスタム認証）

<!--
DataSyncはネットワーク経由の定期同期に最適。Transfer Familyは外部パートナーとのB2Bファイル交換に使われることが多い。
-->

---

# AWS Backup と災害復旧

- **AWS Backup:**
- - **一元管理**でEBS・EFS・S3・RDS・DynamoDB等を横断的にバックアップ
- - バックアッププラン（スケジュール・保持期間・ライフサイクル）をポリシーで定義
- - **クロスリージョン・クロスアカウント**コピーでDR対応
- - **Backup Vault Lock** でWORM準拠（削除不可）
- 
- **DR戦略の指標:**
- - **RPO**（目標復旧時点）: データ損失の許容範囲
- - **RTO**（目標復旧時間）: ダウンタイムの許容範囲

<!--
AWS BackupはOrganizations統合でマルチアカウント環境でも一元管理が可能。Backup Vault Lockはランサムウェア対策としても有効。
-->

---

# ストレージサービス選定フロー

| 要件 | 推奨サービス |
|------|-------------|
| オブジェクト保存・データレイク | **S3** |
| EC2のブートボリューム・DB | **EBS** |
| 共有ファイルシステム（Linux） | **EFS** |
| 共有ファイルシステム（Windows） | **FSx for Windows** |
| HPC・ML高速処理 | **FSx for Lustre** |
| オンプレ ↔ クラウド接続 | **Storage Gateway** |
| 大容量オフライン移行 | **Snow Family** |

<!--
試験ではユースケースに応じた最適なサービス選択が頻出。特にS3とEBSとEFSの使い分けは必須知識。
-->

---

# まとめ — AWS ストレージサービス

- - **S3**: イレブンナイン耐久性のオブジェクトストレージ（8クラス）
- - **EBS**: EC2向け高性能ブロックストレージ（gp3推奨）
- - **EFS**: マネージドNFS（自動スケール・マルチAZ）
- - **FSx**: 4つの専用ファイルシステム（Windows/Lustre/ONTAP/OpenZFS）
- - **Storage Gateway**: ハイブリッド接続（File/Volume/Tape）
- - **Snow Family**: 大容量オフライン移行デバイス
- - **AWS Backup**: 一元的バックアップ管理とDR戦略

<!--
ストレージ選定は「データの種類」「アクセスパターン」「パフォーマンス要件」「コスト」の4軸で判断する。
-->

<svg viewBox="0 0 800 390" xmlns="http://www.w3.org/2000/svg" style="max-height:70vh;max-width:100%;display:block;margin:0 auto;letter-spacing:0">
  <rect width="800" height="390" fill="#f8f9fa" rx="8"/>
  <text x="400" y="24" text-anchor="middle" font-size="13" font-weight="bold" fill="#2c3e50" font-family="sans-serif">リフレッシュトークン戦略 — ライフサイクルと設計</text>

  <!-- Access Token Lifecycle -->
  <text x="400" y="48" text-anchor="middle" font-size="10" font-weight="bold" fill="#3498db" font-family="sans-serif">Access Token ライフサイクル</text>

  <!-- State: Issued -->
  <rect x="18" y="56" width="108" height="46" rx="6" fill="#27ae60" style="filter:drop-shadow(1px 1px 3px rgba(0,0,0,0.15))"/>
  <text x="72" y="76" text-anchor="middle" font-size="10" font-weight="bold" fill="white" font-family="sans-serif">発行</text>
  <text x="72" y="92" text-anchor="middle" font-size="8" fill="#d5f5e3" font-family="sans-serif">JWT signed / RS256</text>

  <line x1="126" y1="79" x2="162" y2="79" stroke="#27ae60" stroke-width="1.5"/>
  <polygon points="162,79 152,74 152,84" fill="#27ae60"/>

  <!-- State: Active -->
  <rect x="163" y="56" width="108" height="46" rx="6" fill="#2980b9" style="filter:drop-shadow(1px 1px 3px rgba(0,0,0,0.15))"/>
  <text x="217" y="76" text-anchor="middle" font-size="10" font-weight="bold" fill="white" font-family="sans-serif">有効</text>
  <text x="217" y="92" text-anchor="middle" font-size="8" fill="#aed6f1" font-family="sans-serif">API 呼び出し可能</text>

  <line x1="271" y1="79" x2="307" y2="79" stroke="#2980b9" stroke-width="1.5"/>
  <polygon points="307,79 297,74 297,84" fill="#2980b9"/>
  <text x="289" y="71" text-anchor="middle" font-size="8" fill="#7f8c8d" font-family="sans-serif">exp 接近</text>

  <!-- State: Near Expiry -->
  <rect x="308" y="56" width="108" height="46" rx="6" fill="#f39c12" style="filter:drop-shadow(1px 1px 3px rgba(0,0,0,0.15))"/>
  <text x="362" y="76" text-anchor="middle" font-size="10" font-weight="bold" fill="white" font-family="sans-serif">期限切れ間近</text>
  <text x="362" y="92" text-anchor="middle" font-size="8" fill="#fdebd0" font-family="sans-serif">exp - 60s で検知</text>

  <line x1="416" y1="79" x2="452" y2="79" stroke="#f39c12" stroke-width="1.5"/>
  <polygon points="452,79 442,74 442,84" fill="#f39c12"/>

  <!-- State: Expired -->
  <rect x="453" y="56" width="108" height="46" rx="6" fill="#e74c3c" style="filter:drop-shadow(1px 1px 3px rgba(0,0,0,0.15))"/>
  <text x="507" y="76" text-anchor="middle" font-size="10" font-weight="bold" fill="white" font-family="sans-serif">失効</text>
  <text x="507" y="92" text-anchor="middle" font-size="8" fill="#fdecea" font-family="sans-serif">401 Unauthorized</text>

  <line x1="561" y1="79" x2="597" y2="79" stroke="#e74c3c" stroke-width="1.5"/>
  <polygon points="597,79 587,74 587,84" fill="#e74c3c"/>
  <text x="579" y="71" text-anchor="middle" font-size="7" fill="#7f8c8d" font-family="sans-serif">RFC 7009</text>

  <!-- State: Revoked -->
  <rect x="598" y="56" width="108" height="46" rx="6" fill="#7f8c8d" style="filter:drop-shadow(1px 1px 3px rgba(0,0,0,0.15))"/>
  <text x="652" y="76" text-anchor="middle" font-size="10" font-weight="bold" fill="white" font-family="sans-serif">失効 (強制)</text>
  <text x="652" y="92" text-anchor="middle" font-size="8" fill="#ecf0f1" font-family="sans-serif">即時無効 / 監査ログ</text>

  <!-- RT Rotation Section -->
  <text x="400" y="126" text-anchor="middle" font-size="10" font-weight="bold" fill="#9b59b6" font-family="sans-serif">Refresh Token Rotation (推奨実装)</text>

  <!-- RT Rotation flow -->
  <rect x="18" y="136" width="360" height="110" rx="8" fill="#f3e5f5" stroke="#9b59b6" stroke-width="1.5"/>
  <text x="198" y="156" text-anchor="middle" font-size="10" font-weight="bold" fill="#6c3483" font-family="sans-serif">Rotation フロー</text>

  <rect x="32" y="164" width="90" height="36" rx="5" fill="#9b59b6"/>
  <text x="77" y="180" text-anchor="middle" font-size="9" font-weight="bold" fill="white" font-family="sans-serif">旧 Refresh</text>
  <text x="77" y="194" text-anchor="middle" font-size="9" fill="#e8d5f5" font-family="sans-serif">Token</text>

  <line x1="122" y1="182" x2="152" y2="182" stroke="#7d3c98" stroke-width="1.5"/>
  <polygon points="152,182 142,177 142,187" fill="#7d3c98"/>

  <rect x="153" y="164" width="80" height="36" rx="5" fill="#7d3c98"/>
  <text x="193" y="180" text-anchor="middle" font-size="9" font-weight="bold" fill="white" font-family="sans-serif">Token</text>
  <text x="193" y="194" text-anchor="middle" font-size="9" fill="#e8d5f5" font-family="sans-serif">Endpoint</text>

  <line x1="233" y1="182" x2="263" y2="182" stroke="#27ae60" stroke-width="1.5"/>
  <polygon points="263,182 253,177 253,187" fill="#27ae60"/>

  <rect x="264" y="158" width="98" height="20" rx="4" fill="#27ae60"/>
  <text x="313" y="173" text-anchor="middle" font-size="9" fill="white" font-family="sans-serif">新 Access Token</text>
  <rect x="264" y="184" width="98" height="20" rx="4" fill="#1e8449"/>
  <text x="313" y="199" text-anchor="middle" font-size="9" fill="white" font-family="sans-serif">新 Refresh Token</text>

  <rect x="32" y="216" width="330" height="22" rx="4" fill="#c0392b" fill-opacity="0.15"/>
  <text x="197" y="231" text-anchor="middle" font-size="9" fill="#c0392b" font-family="sans-serif">旧 RT は即失効 → 再利用 → 全セッション無効化（盗用検知）</text>

  <!-- Design Guide Table -->
  <rect x="392" y="136" width="390" height="110" rx="8" fill="#fff" stroke="#bdc3c7" stroke-width="1"/>
  <text x="587" y="156" text-anchor="middle" font-size="10" font-weight="bold" fill="#2c3e50" font-family="sans-serif">有効期限設計指針</text>

  <!-- Table header -->
  <rect x="402" y="162" width="370" height="20" rx="3" fill="#ecf0f1"/>
  <text x="462" y="176" text-anchor="middle" font-size="9" font-weight="bold" fill="#2c3e50" font-family="sans-serif">種別</text>
  <text x="562" y="176" text-anchor="middle" font-size="9" font-weight="bold" fill="#2c3e50" font-family="sans-serif">推奨期限</text>
  <text x="682" y="176" text-anchor="middle" font-size="9" font-weight="bold" fill="#2c3e50" font-family="sans-serif">備考</text>

  <text x="412" y="198" font-size="9" fill="#2c3e50" font-family="sans-serif">Access Token</text>
  <text x="522" y="198" font-size="9" fill="#2c3e50" font-family="sans-serif">15〜60 分</text>
  <text x="622" y="198" font-size="9" fill="#7f8c8d" font-family="sans-serif">短いほどセキュア</text>

  <text x="412" y="214" font-size="9" fill="#2c3e50" font-family="sans-serif">Refresh Token</text>
  <text x="522" y="214" font-size="9" fill="#2c3e50" font-family="sans-serif">24時間〜7日</text>
  <text x="622" y="214" font-size="9" fill="#7f8c8d" font-family="sans-serif">スライディング推奨</text>

  <text x="412" y="230" font-size="9" fill="#2c3e50" font-family="sans-serif">ID Token</text>
  <text x="522" y="230" font-size="9" fill="#2c3e50" font-family="sans-serif">AT と同じ</text>
  <text x="622" y="230" font-size="9" fill="#7f8c8d" font-family="sans-serif">認証確認用のみ</text>

  <!-- Footer -->
  <rect x="15" y="264" width="770" height="112" rx="8" fill="#2c3e50"/>
  <text x="400" y="283" text-anchor="middle" font-size="10" font-weight="bold" fill="#f1c40f" font-family="sans-serif">実装パターン比較</text>

  <text x="25" y="301" font-size="9" fill="#ecf0f1" font-family="sans-serif">Silent Refresh（旧来型SPA）</text>
  <text x="190" y="301" font-size="9" fill="#bdc3c7" font-family="sans-serif">: hidden iframe で定期更新。LocalStorage に RT を置かない。XSS に注意</text>

  <text x="25" y="318" font-size="9" fill="#ecf0f1" font-family="sans-serif">RT Rotation（推奨）</text>
  <text x="190" y="318" font-size="9" fill="#bdc3c7" font-family="sans-serif">: Token Endpoint でのみ交換。HttpOnly Cookie で保存。SameSite=Strict</text>

  <text x="25" y="335" font-size="9" fill="#ecf0f1" font-family="sans-serif">DPoP Binding（最高）</text>
  <text x="190" y="335" font-size="9" fill="#bdc3c7" font-family="sans-serif">: トークンを鍵ペアに束縛。盗難されても別デバイスで使用不可（RFC 9449）</text>

  <text x="25" y="353" font-size="9" fill="#aed6f1" font-family="sans-serif">Cognito: User Pool の「Refresh token expiration」設定。Advanced Security で Rotation 有効化</text>
  <text x="25" y="369" font-size="9" fill="#aed6f1" font-family="sans-serif">Cognito: absolute expiry（最長60日） + sliding expiry（非活動後の自動失効）をサポート</text>
</svg>

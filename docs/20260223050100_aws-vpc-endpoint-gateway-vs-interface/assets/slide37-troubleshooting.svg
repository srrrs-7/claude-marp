<svg viewBox="0 0 800 400" xmlns="http://www.w3.org/2000/svg" style="max-height:70vh;width:auto;display:block;margin:0 auto;letter-spacing:0">
  <rect width="800" height="400" fill="#fafafa"/>
  <text x="400" y="24" font-family="Arial,sans-serif" font-size="13" fill="#7b5ea7" font-weight="bold" text-anchor="middle">接続確認 — 基本トラブルシューティングフロー</text>
  <!-- Start -->
  <rect x="310" y="36" width="180" height="30" rx="15" fill="#7b5ea7"/>
  <text x="400" y="56" font-family="Arial,sans-serif" font-size="10" fill="#fff" font-weight="bold" text-anchor="middle">AWS サービスへの接続失敗</text>
  <!-- Arrow down -->
  <line x1="400" y1="66" x2="400" y2="82" stroke="#555" stroke-width="1.5"/>
  <polygon points="394,78 400,86 406,78" fill="#555"/>
  <!-- Q1 -->
  <rect x="265" y="82" width="270" height="32" rx="4" fill="#fef9c3" stroke="#f59e0b" stroke-width="2"/>
  <text x="400" y="103" font-family="Arial,sans-serif" font-size="10" fill="#b45309" text-anchor="middle" font-weight="bold">① VPC Endpoint のステータスは?</text>
  <!-- Q1 YES -->
  <line x1="400" y1="114" x2="400" y2="128" stroke="#555" stroke-width="1.5"/>
  <polygon points="394,124 400,132 406,124" fill="#555"/>
  <text x="418" y="125" font-family="Arial,sans-serif" font-size="9" fill="#10b981">available</text>
  <!-- Q1 NO: pending/deleting -->
  <line x1="265" y1="98" x2="158" y2="98" stroke="#ef4444" stroke-width="1.5"/>
  <polygon points="162,92 150,98 162,104" fill="#ef4444"/>
  <text x="205" y="93" font-family="Arial,sans-serif" font-size="9" fill="#ef4444">pending / error</text>
  <rect x="30" y="82" width="128" height="30" rx="4" fill="#fee2e2" stroke="#ef4444" stroke-width="1"/>
  <text x="94" y="102" font-family="Arial,sans-serif" font-size="9" fill="#ef4444" text-anchor="middle">EP を再作成</text>
  <!-- Q2 -->
  <rect x="265" y="128" width="270" height="32" rx="4" fill="#fef9c3" stroke="#f59e0b" stroke-width="2"/>
  <text x="400" y="149" font-family="Arial,sans-serif" font-size="10" fill="#b45309" text-anchor="middle" font-weight="bold">② DNS 解決は正しいか?</text>
  <line x1="400" y1="160" x2="400" y2="174" stroke="#555" stroke-width="1.5"/>
  <polygon points="394,170 400,178 406,170" fill="#555"/>
  <text x="418" y="170" font-family="Arial,sans-serif" font-size="9" fill="#10b981">正しい</text>
  <!-- Q2 NO -->
  <line x1="265" y1="144" x2="158" y2="144" stroke="#ef4444" stroke-width="1.5"/>
  <polygon points="162,138 150,144 162,150" fill="#ef4444"/>
  <text x="205" y="138" font-family="Arial,sans-serif" font-size="9" fill="#ef4444">パブリック IP</text>
  <rect x="15" y="128" width="143" height="44" rx="4" fill="#fee2e2" stroke="#ef4444" stroke-width="1"/>
  <text x="86" y="146" font-family="Arial,sans-serif" font-size="9" fill="#ef4444" text-anchor="middle">Private DNS を有効化</text>
  <text x="86" y="160" font-family="Arial,sans-serif" font-size="9" fill="#888" text-anchor="middle">or カスタム DNS 設定</text>
  <!-- Q3 -->
  <rect x="265" y="174" width="270" height="32" rx="4" fill="#fef9c3" stroke="#f59e0b" stroke-width="2"/>
  <text x="400" y="195" font-family="Arial,sans-serif" font-size="10" fill="#b45309" text-anchor="middle" font-weight="bold">③ SG / NACLは接続を許可しているか?</text>
  <line x1="400" y1="206" x2="400" y2="220" stroke="#555" stroke-width="1.5"/>
  <polygon points="394,216 400,224 406,216" fill="#555"/>
  <text x="418" y="217" font-family="Arial,sans-serif" font-size="9" fill="#10b981">許可</text>
  <!-- Q3 NO -->
  <line x1="535" y1="190" x2="620" y2="190" stroke="#ef4444" stroke-width="1.5"/>
  <polygon points="616,184 628,190 616,196" fill="#ef4444"/>
  <text x="577" y="184" font-family="Arial,sans-serif" font-size="9" fill="#ef4444">拒否</text>
  <rect x="620" y="174" width="165" height="44" rx="4" fill="#fee2e2" stroke="#ef4444" stroke-width="1"/>
  <text x="702" y="190" font-family="Arial,sans-serif" font-size="9" fill="#ef4444" text-anchor="middle">sg-ep に Inbound 443</text>
  <text x="702" y="205" font-family="Arial,sans-serif" font-size="9" fill="#888" text-anchor="middle">NACL の Stateless に注意</text>
  <!-- Q4 -->
  <rect x="265" y="220" width="270" height="32" rx="4" fill="#fef9c3" stroke="#f59e0b" stroke-width="2"/>
  <text x="400" y="241" font-family="Arial,sans-serif" font-size="10" fill="#b45309" text-anchor="middle" font-weight="bold">④ Endpoint Policy は許可しているか?</text>
  <line x1="400" y1="252" x2="400" y2="266" stroke="#555" stroke-width="1.5"/>
  <polygon points="394,262 400,270 406,262" fill="#555"/>
  <text x="418" y="263" font-family="Arial,sans-serif" font-size="9" fill="#10b981">許可</text>
  <!-- Q4 NO -->
  <line x1="535" y1="236" x2="620" y2="236" stroke="#ef4444" stroke-width="1.5"/>
  <polygon points="616,230 628,236 616,242" fill="#ef4444"/>
  <text x="577" y="230" font-family="Arial,sans-serif" font-size="9" fill="#ef4444">拒否</text>
  <rect x="620" y="220" width="165" height="44" rx="4" fill="#fee2e2" stroke="#ef4444" stroke-width="1"/>
  <text x="702" y="236" font-family="Arial,sans-serif" font-size="9" fill="#ef4444" text-anchor="middle">Endpoint Policy を確認</text>
  <text x="702" y="251" font-family="Arial,sans-serif" font-size="9" fill="#888" text-anchor="middle">Principal / Action / Condition</text>
  <!-- Q5 -->
  <rect x="265" y="266" width="270" height="32" rx="4" fill="#fef9c3" stroke="#f59e0b" stroke-width="2"/>
  <text x="400" y="287" font-family="Arial,sans-serif" font-size="10" fill="#b45309" text-anchor="middle" font-weight="bold">⑤ IAM / Resource Policy は許可?</text>
  <line x1="400" y1="298" x2="400" y2="312" stroke="#555" stroke-width="1.5"/>
  <polygon points="394,308 400,316 406,308" fill="#555"/>
  <text x="418" y="309" font-family="Arial,sans-serif" font-size="9" fill="#10b981">許可</text>
  <!-- Q5 NO -->
  <line x1="535" y1="282" x2="620" y2="282" stroke="#ef4444" stroke-width="1.5"/>
  <polygon points="616,276 628,282 616,288" fill="#ef4444"/>
  <text x="577" y="276" font-family="Arial,sans-serif" font-size="9" fill="#ef4444">拒否</text>
  <rect x="620" y="266" width="165" height="44" rx="4" fill="#fee2e2" stroke="#ef4444" stroke-width="1"/>
  <text x="702" y="282" font-family="Arial,sans-serif" font-size="9" fill="#ef4444" text-anchor="middle">IAM / Bucket Policy 確認</text>
  <text x="702" y="297" font-family="Arial,sans-serif" font-size="9" fill="#888" text-anchor="middle">CloudTrail で Deny を確認</text>
  <!-- Resolution -->
  <rect x="300" y="312" width="200" height="30" rx="15" fill="#10b981"/>
  <text x="400" y="332" font-family="Arial,sans-serif" font-size="10" fill="#fff" font-weight="bold" text-anchor="middle">接続成功 / 問題解決</text>
  <!-- Diagnostic commands box -->
  <rect x="15" y="350" width="770" height="40" rx="5" fill="#f0fdf4" stroke="#10b981" stroke-width="1"/>
  <text x="22" y="365" font-family="Arial,sans-serif" font-size="9" fill="#059669" font-weight="bold">診断コマンド:</text>
  <text x="110" y="365" font-family="monospace,Arial" font-size="9" fill="#333">nslookup ssm.ap-northeast-1.amazonaws.com</text>
  <text x="420" y="365" font-family="monospace,Arial" font-size="9" fill="#333">curl -v https://ssm.ap-northeast-1.amazonaws.com</text>
  <text x="22" y="383" font-family="monospace,Arial" font-size="9" fill="#333">aws ec2 describe-vpc-endpoints --query 'VpcEndpoints[].State'</text>
  <text x="350" y="383" font-family="monospace,Arial" font-size="9" fill="#333">aws logs filter-log-events --log-group-name VPCFlowLogs</text>
</svg>

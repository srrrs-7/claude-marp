<svg viewBox="0 0 960 420" xmlns="http://www.w3.org/2000/svg" style="max-height:70vh;width:auto;display:block;margin:0 auto;letter-spacing:0;font-family:'Helvetica Neue',Arial,sans-serif">
  <rect width="960" height="420" fill="#f8fafc" rx="12"/>
  <text x="480" y="34" text-anchor="middle" font-size="18" font-weight="bold" fill="#1e293b">IRSA（IAM Roles for Service Accounts）認証フロー</text>

  <!-- Step 1: Pod -->
  <rect x="30" y="80" width="150" height="80" rx="10" fill="#dbeafe" stroke="#3b82f6" stroke-width="2"/>
  <text x="105" y="115" text-anchor="middle" font-size="13" font-weight="bold" fill="#1e40af">Pod</text>
  <text x="105" y="133" text-anchor="middle" font-size="11" fill="#1e40af">ServiceAccount</text>
  <text x="105" y="149" text-anchor="middle" font-size="10" fill="#1e40af">（JWT Token付与）</text>

  <!-- Arrow 1→2 -->
  <line x1="180" y1="120" x2="230" y2="120" stroke="#64748b" stroke-width="2"/>
  <polygon points="234,120 226,115 226,125" fill="#64748b"/>
  <text x="205" y="112" text-anchor="middle" font-size="9" fill="#64748b">①JWT</text>

  <!-- Step 2: OIDC Provider -->
  <rect x="233" y="80" width="160" height="80" rx="10" fill="#ede9fe" stroke="#7c3aed" stroke-width="2"/>
  <text x="313" y="110" text-anchor="middle" font-size="13" font-weight="bold" fill="#5b21b6">OIDC Provider</text>
  <text x="313" y="128" text-anchor="middle" font-size="11" fill="#5b21b6">EKS管理</text>
  <text x="313" y="146" text-anchor="middle" font-size="10" fill="#5b21b6">JWT検証・署名確認</text>

  <!-- Arrow 2→3 -->
  <line x1="393" y1="120" x2="443" y2="120" stroke="#64748b" stroke-width="2"/>
  <polygon points="447,120 439,115 439,125" fill="#64748b"/>
  <text x="420" y="112" text-anchor="middle" font-size="9" fill="#64748b">②検証OK</text>

  <!-- Step 3: STS -->
  <rect x="447" y="80" width="160" height="80" rx="10" fill="#fee2e2" stroke="#dc2626" stroke-width="2"/>
  <text x="527" y="110" text-anchor="middle" font-size="13" font-weight="bold" fill="#991b1b">AWS STS</text>
  <text x="527" y="128" text-anchor="middle" font-size="11" fill="#991b1b">AssumeRoleWith</text>
  <text x="527" y="145" text-anchor="middle" font-size="11" fill="#991b1b">WebIdentity</text>

  <!-- Arrow 3→4 -->
  <line x1="607" y1="120" x2="657" y2="120" stroke="#64748b" stroke-width="2"/>
  <polygon points="661,120 653,115 653,125" fill="#64748b"/>
  <text x="634" y="112" text-anchor="middle" font-size="9" fill="#64748b">③一時Cred</text>

  <!-- Step 4: IAM Role -->
  <rect x="661" y="80" width="160" height="80" rx="10" fill="#dcfce7" stroke="#16a34a" stroke-width="2"/>
  <text x="741" y="110" text-anchor="middle" font-size="13" font-weight="bold" fill="#166534">IAM Role</text>
  <text x="741" y="128" text-anchor="middle" font-size="11" fill="#166534">信頼ポリシー:</text>
  <text x="741" y="146" text-anchor="middle" font-size="10" fill="#166534">SA名・Namespace確認</text>

  <!-- Arrow 4→5 -->
  <line x1="821" y1="120" x2="871" y2="120" stroke="#64748b" stroke-width="2"/>
  <polygon points="875,120 867,115 867,125" fill="#64748b"/>
  <text x="848" y="112" text-anchor="middle" font-size="9" fill="#64748b">④権限付与</text>

  <!-- Step 5: AWS Service -->
  <rect x="875" y="80" width="70" height="80" rx="10" fill="#fef3c7" stroke="#d97706" stroke-width="2"/>
  <text x="910" y="115" text-anchor="middle" font-size="12" font-weight="bold" fill="#92400e">AWS</text>
  <text x="910" y="133" text-anchor="middle" font-size="11" fill="#92400e">Service</text>
  <text x="910" y="150" text-anchor="middle" font-size="10" fill="#92400e">(S3等)</text>

  <!-- Setup flow (below) -->
  <text x="480" y="210" text-anchor="middle" font-size="14" font-weight="bold" fill="#1e293b">設定手順</text>

  <!-- Setup boxes -->
  <rect x="30" y="230" width="200" height="70" rx="8" fill="#f1f5f9" stroke="#64748b" stroke-width="1.5"/>
  <text x="130" y="253" text-anchor="middle" font-size="12" font-weight="bold" fill="#334155">Step 1: OIDC設定</text>
  <text x="130" y="270" text-anchor="middle" font-size="10" fill="#475569">eksctl utils associate-iam-</text>
  <text x="130" y="285" text-anchor="middle" font-size="10" fill="#475569">oidc-provider --approve</text>

  <line x1="230" y1="265" x2="260" y2="265" stroke="#64748b" stroke-width="1.5"/>
  <polygon points="264,265 256,260 256,270" fill="#64748b"/>

  <rect x="263" y="230" width="200" height="70" rx="8" fill="#f1f5f9" stroke="#64748b" stroke-width="1.5"/>
  <text x="363" y="253" text-anchor="middle" font-size="12" font-weight="bold" fill="#334155">Step 2: IAMロール作成</text>
  <text x="363" y="270" text-anchor="middle" font-size="10" fill="#475569">eksctl create iamserviceaccount</text>
  <text x="363" y="285" text-anchor="middle" font-size="10" fill="#475569">--attach-policy-arn=...</text>

  <line x1="463" y1="265" x2="493" y2="265" stroke="#64748b" stroke-width="1.5"/>
  <polygon points="497,265 489,260 489,270" fill="#64748b"/>

  <rect x="496" y="230" width="200" height="70" rx="8" fill="#f1f5f9" stroke="#64748b" stroke-width="1.5"/>
  <text x="596" y="253" text-anchor="middle" font-size="12" font-weight="bold" fill="#334155">Step 3: SA アノテーション</text>
  <text x="596" y="270" text-anchor="middle" font-size="10" fill="#475569">eks.amazonaws.com/</text>
  <text x="596" y="285" text-anchor="middle" font-size="10" fill="#475569">role-arn: arn:aws:iam::...</text>

  <line x1="696" y1="265" x2="726" y2="265" stroke="#64748b" stroke-width="1.5"/>
  <polygon points="730,265 722,260 722,270" fill="#64748b"/>

  <rect x="729" y="230" width="200" height="70" rx="8" fill="#dbeafe" stroke="#3b82f6" stroke-width="1.5"/>
  <text x="829" y="253" text-anchor="middle" font-size="12" font-weight="bold" fill="#1e40af">Step 4: Pod実行</text>
  <text x="829" y="270" text-anchor="middle" font-size="10" fill="#1e40af">AWS_WEB_IDENTITY_</text>
  <text x="829" y="285" text-anchor="middle" font-size="10" fill="#1e40af">TOKEN_FILE が自動注入</text>

  <!-- Key points -->
  <rect x="30" y="320" width="900" height="80" rx="8" fill="#1e293b"/>
  <text x="480" y="345" text-anchor="middle" font-size="13" font-weight="bold" fill="#FF9900">試験重要ポイント</text>
  <text x="50" y="367" font-size="11" fill="#e2e8f0">✓ IRSA = ServiceAccount に IAM Role を紐付ける仕組み（EC2インスタンスプロファイル不要）</text>
  <text x="50" y="385" font-size="11" fill="#e2e8f0">✓ 信頼ポリシー条件: StringEquals / StringLike で Namespace + ServiceAccount名を制限 → 最小権限</text>
  <text x="50" y="403" font-size="11" fill="#e2e8f0">✓ EKS Pod Identity（新）は OIDC 設定不要・eksctl 不要で より簡単</text>
</svg>

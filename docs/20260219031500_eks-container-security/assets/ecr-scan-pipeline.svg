<svg viewBox="0 0 960 400" xmlns="http://www.w3.org/2000/svg" style="max-height:70vh;width:auto;display:block;margin:0 auto;letter-spacing:0;font-family:'Helvetica Neue',Arial,sans-serif">
  <rect width="960" height="400" fill="#f8fafc" rx="12"/>
  <text x="480" y="34" text-anchor="middle" font-size="18" font-weight="bold" fill="#1e293b">ECR イメージスキャン・署名 CI/CDパイプライン</text>

  <!-- Dev -->
  <rect x="20" y="80" width="120" height="70" rx="10" fill="#dbeafe" stroke="#3b82f6" stroke-width="2"/>
  <text x="80" y="110" text-anchor="middle" font-size="12" font-weight="bold" fill="#1e40af">開発者</text>
  <text x="80" y="128" text-anchor="middle" font-size="10" fill="#1e40af">git push</text>
  <text x="80" y="144" text-anchor="middle" font-size="10" fill="#1e40af">コード変更</text>

  <!-- Arrow -->
  <line x1="140" y1="115" x2="165" y2="115" stroke="#64748b" stroke-width="2"/>
  <polygon points="169,115 161,110 161,120" fill="#64748b"/>

  <!-- CI/CD -->
  <rect x="168" y="80" width="130" height="70" rx="10" fill="#ede9fe" stroke="#7c3aed" stroke-width="2"/>
  <text x="233" y="104" text-anchor="middle" font-size="12" font-weight="bold" fill="#5b21b6">CI/CD Build</text>
  <text x="233" y="120" text-anchor="middle" font-size="10" fill="#5b21b6">CodeBuild /</text>
  <text x="233" y="136" text-anchor="middle" font-size="10" fill="#5b21b6">GitHub Actions</text>
  <text x="233" y="150" text-anchor="middle" font-size="10" fill="#5b21b6">docker build</text>

  <!-- Arrow -->
  <line x1="298" y1="115" x2="323" y2="115" stroke="#64748b" stroke-width="2"/>
  <polygon points="327,115 319,110 319,120" fill="#64748b"/>

  <!-- Trivy scan -->
  <rect x="326" y="66" width="130" height="100" rx="10" fill="#fef3c7" stroke="#d97706" stroke-width="2"/>
  <text x="391" y="90" text-anchor="middle" font-size="12" font-weight="bold" fill="#92400e">脆弱性スキャン</text>
  <text x="391" y="108" text-anchor="middle" font-size="11" fill="#92400e">Trivy / Snyk</text>
  <text x="391" y="124" text-anchor="middle" font-size="10" fill="#92400e">（CIパイプライン）</text>
  <text x="391" y="141" text-anchor="middle" font-size="9" fill="#d97706">CRITICAL検出→FAIL</text>
  <text x="391" y="157" text-anchor="middle" font-size="9" fill="#92400e">SBOM生成 (CycloneDX)</text>

  <!-- Fail path -->
  <line x1="391" y1="166" x2="391" y2="210" stroke="#dc2626" stroke-width="2" stroke-dasharray="4,3"/>
  <polygon points="391,214 386,206 396,206" fill="#dc2626"/>
  <rect x="320" y="214" width="140" height="36" rx="8" fill="#fee2e2" stroke="#dc2626" stroke-width="1.5"/>
  <text x="390" y="237" text-anchor="middle" font-size="11" fill="#991b1b">ビルド失敗・PR BLOCK</text>

  <!-- Pass arrow -->
  <line x1="456" y1="115" x2="488" y2="115" stroke="#64748b" stroke-width="2"/>
  <polygon points="492,115 484,110 484,120" fill="#64748b"/>
  <text x="472" y="107" text-anchor="middle" font-size="9" fill="#16a34a">Pass</text>

  <!-- ECR Push -->
  <rect x="491" y="80" width="120" height="70" rx="10" fill="#dcfce7" stroke="#16a34a" stroke-width="2"/>
  <text x="551" y="104" text-anchor="middle" font-size="12" font-weight="bold" fill="#166534">ECR Push</text>
  <text x="551" y="120" text-anchor="middle" font-size="10" fill="#166534">イメージプッシュ</text>
  <text x="551" y="136" text-anchor="middle" font-size="10" fill="#166534">+ 署名</text>
  <text x="551" y="150" text-anchor="middle" font-size="10" fill="#166534">(Notation/AWS Signer)</text>

  <!-- Arrow -->
  <line x1="611" y1="115" x2="641" y2="115" stroke="#64748b" stroke-width="2"/>
  <polygon points="645,115 637,110 637,120" fill="#64748b"/>

  <!-- ECR Enhanced Scan -->
  <rect x="644" y="66" width="150" height="100" rx="10" fill="#fee2e2" stroke="#dc2626" stroke-width="2"/>
  <text x="719" y="90" text-anchor="middle" font-size="12" font-weight="bold" fill="#991b1b">ECR 拡張スキャン</text>
  <text x="719" y="108" text-anchor="middle" font-size="11" fill="#991b1b">Amazon Inspector V2</text>
  <text x="719" y="124" text-anchor="middle" font-size="10" fill="#991b1b">OS + 言語パッケージ</text>
  <text x="719" y="141" text-anchor="middle" font-size="10" fill="#7f1d1d">継続スキャン（Push後も）</text>
  <text x="719" y="157" text-anchor="middle" font-size="9" fill="#991b1b">Security Hub 連携</text>

  <!-- Arrow -->
  <line x1="794" y1="115" x2="824" y2="115" stroke="#64748b" stroke-width="2"/>
  <polygon points="828,115 820,110 820,120" fill="#64748b"/>

  <!-- Admission Control -->
  <rect x="827" y="66" width="115" height="100" rx="10" fill="#1e293b"/>
  <text x="884" y="92" text-anchor="middle" font-size="11" font-weight="bold" fill="#FF9900">Admission</text>
  <text x="884" y="108" text-anchor="middle" font-size="11" font-weight="bold" fill="#FF9900">Control</text>
  <text x="884" y="126" text-anchor="middle" font-size="10" fill="#e2e8f0">OPA Gatekeeper</text>
  <text x="884" y="142" text-anchor="middle" font-size="10" fill="#e2e8f0">Kyverno</text>
  <text x="884" y="158" text-anchor="middle" font-size="10" fill="#94a3b8">署名検証 → Deploy許可</text>

  <!-- Bottom legend -->
  <rect x="20" y="300" width="920" height="86" rx="8" fill="#f1f5f9" stroke="#cbd5e1" stroke-width="1"/>
  <text x="480" y="322" text-anchor="middle" font-size="13" font-weight="bold" fill="#1e293b">スキャン方式比較</text>
  <rect x="40" y="334" width="18" height="14" rx="2" fill="#d97706"/>
  <text x="66" y="346" font-size="11" fill="#334155">基本スキャン: プッシュ時のみ・OS脆弱性のみ・無料</text>
  <rect x="40" y="356" width="18" height="14" rx="2" fill="#dc2626"/>
  <text x="66" y="368" font-size="11" fill="#334155">拡張スキャン（Inspector V2）: 継続スキャン・OS+言語パッケージ・Security Hub連携・有料</text>
  <text x="40" y="380" font-size="11" fill="#64748b">試験TIP: 「継続的なスキャン」「アプリ依存関係のスキャン」→ 拡張スキャン（Inspector）を選択</text>
</svg>

<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 900 500" style="max-height:70vh;width:auto;display:block;margin:0 auto;letter-spacing:0">
  <rect width="900" height="500" fill="#0f172a"/>
  <text x="450" y="28" text-anchor="middle" font-family="sans-serif" font-size="15" font-weight="bold" fill="#f1f5f9">SageMaker Clarify バイアス検出・説明可能性</text>

  <!-- Phase 1: Pre-training Bias -->
  <rect x="15" y="48" width="275" height="175" rx="8" fill="#1e293b" stroke="#ef4444" stroke-width="2"/>
  <text x="152" y="72" text-anchor="middle" font-family="sans-serif" font-size="11" font-weight="bold" fill="#ef4444">Phase 1: Pre-training Bias</text>
  <text x="152" y="88" text-anchor="middle" font-family="sans-serif" font-size="9" fill="#94a3b8">データレベルのバイアス検出</text>

  <!-- Dataset input -->
  <rect x="30" y="100" width="100" height="40" rx="5" fill="#0f172a" stroke="#3b82f6" stroke-width="1"/>
  <text x="80" y="118" text-anchor="middle" font-family="sans-serif" font-size="9" fill="#3b82f6">訓練データ</text>
  <text x="80" y="133" text-anchor="middle" font-family="sans-serif" font-size="8" fill="#94a3b8">(S3 CSV)</text>

  <!-- Arrow -->
  <line x1="130" y1="120" x2="155" y2="120" stroke="#ef4444" stroke-width="1.5"/>
  <polygon points="155,120 143,115 143,125" fill="#ef4444"/>

  <!-- Clarify job -->
  <rect x="155" y="103" width="115" height="36" rx="4" fill="#0f172a" stroke="#ef4444" stroke-width="1"/>
  <text x="212" y="119" text-anchor="middle" font-family="sans-serif" font-size="8" font-weight="bold" fill="#ef4444">Clarify</text>
  <text x="212" y="132" text-anchor="middle" font-family="sans-serif" font-size="8" fill="#94a3b8">Processing Job</text>

  <!-- Metrics -->
  <rect x="30" y="158" width="245" height="50" rx="4" fill="#0f172a" stroke="#334155" stroke-width="1"/>
  <text x="152" y="175" text-anchor="middle" font-family="sans-serif" font-size="8" font-weight="bold" fill="#ef4444">バイアス指標: CI, DPL, KL, TVD, KS</text>
  <text x="152" y="190" text-anchor="middle" font-family="sans-serif" font-size="8" fill="#94a3b8">Class Imbalance / 差分正ラベル率 / JS距離</text>
  <text x="152" y="203" text-anchor="middle" font-family="sans-serif" font-size="8" fill="#94a3b8">→ Bias Report (HTML / JSON)</text>

  <!-- Phase 2: Post-training Bias -->
  <rect x="315" y="48" width="275" height="175" rx="8" fill="#1e293b" stroke="#f97316" stroke-width="2"/>
  <text x="452" y="72" text-anchor="middle" font-family="sans-serif" font-size="11" font-weight="bold" fill="#f97316">Phase 2: Post-training Bias</text>
  <text x="452" y="88" text-anchor="middle" font-family="sans-serif" font-size="9" fill="#94a3b8">モデルレベルのバイアス検出</text>

  <!-- Model + Dataset inputs -->
  <rect x="328" y="100" width="80" height="35" rx="4" fill="#0f172a" stroke="#3b82f6" stroke-width="1"/>
  <text x="368" y="117" text-anchor="middle" font-family="sans-serif" font-size="9" fill="#3b82f6">モデル</text>
  <text x="368" y="130" text-anchor="middle" font-family="sans-serif" font-size="8" fill="#94a3b8">+ データ</text>

  <line x1="408" y1="117" x2="435" y2="117" stroke="#f97316" stroke-width="1.5"/>
  <polygon points="435,117 423,112 423,122" fill="#f97316"/>

  <rect x="435" y="100" width="115" height="35" rx="4" fill="#0f172a" stroke="#f97316" stroke-width="1"/>
  <text x="492" y="116" text-anchor="middle" font-family="sans-serif" font-size="8" font-weight="bold" fill="#f97316">Clarify</text>
  <text x="492" y="129" text-anchor="middle" font-family="sans-serif" font-size="8" fill="#94a3b8">Processing Job</text>

  <rect x="328" y="155" width="247" height="53" rx="4" fill="#0f172a" stroke="#334155" stroke-width="1"/>
  <text x="452" y="172" text-anchor="middle" font-family="sans-serif" font-size="8" font-weight="bold" fill="#f97316">バイアス指標: DPPL, DI, DCR, RD</text>
  <text x="452" y="187" text-anchor="middle" font-family="sans-serif" font-size="8" fill="#94a3b8">差分正予測率 / 不均等影響 / 条件受け入れ率</text>
  <text x="452" y="202" text-anchor="middle" font-family="sans-serif" font-size="8" fill="#94a3b8">→ Bias Report (HTML / JSON)</text>

  <!-- Phase 3: Explainability -->
  <rect x="615" y="48" width="270" height="175" rx="8" fill="#1e293b" stroke="#a855f7" stroke-width="2"/>
  <text x="750" y="72" text-anchor="middle" font-family="sans-serif" font-size="11" font-weight="bold" fill="#a855f7">Phase 3: Explainability</text>
  <text x="750" y="88" text-anchor="middle" font-family="sans-serif" font-size="9" fill="#94a3b8">予測の説明可能性 (SHAP)</text>

  <rect x="628" y="100" width="80" height="35" rx="4" fill="#0f172a" stroke="#3b82f6" stroke-width="1"/>
  <text x="668" y="117" text-anchor="middle" font-family="sans-serif" font-size="9" fill="#3b82f6">モデル</text>
  <text x="668" y="130" text-anchor="middle" font-family="sans-serif" font-size="8" fill="#94a3b8">+ テストデータ</text>

  <line x1="708" y1="117" x2="733" y2="117" stroke="#a855f7" stroke-width="1.5"/>
  <polygon points="733,117 721,112 721,122" fill="#a855f7"/>

  <rect x="733" y="100" width="135" height="35" rx="4" fill="#0f172a" stroke="#a855f7" stroke-width="1"/>
  <text x="800" y="116" text-anchor="middle" font-family="sans-serif" font-size="8" font-weight="bold" fill="#a855f7">SHAP計算エンジン</text>
  <text x="800" y="130" text-anchor="middle" font-family="sans-serif" font-size="8" fill="#94a3b8">Kernel SHAP</text>

  <rect x="628" y="152" width="242" height="58" rx="4" fill="#0f172a" stroke="#334155" stroke-width="1"/>
  <text x="749" y="170" text-anchor="middle" font-family="sans-serif" font-size="8" font-weight="bold" fill="#a855f7">特徴量重要度スコア</text>
  <text x="749" y="185" text-anchor="middle" font-family="sans-serif" font-size="8" fill="#f1f5f9">age=0.35, income=0.28, credit=0.20...</text>
  <text x="749" y="200" text-anchor="middle" font-family="sans-serif" font-size="8" fill="#94a3b8">グローバル / ローカル説明</text>

  <!-- Reports output row -->
  <rect x="15" y="253" width="870" height="110" rx="8" fill="#1e293b" stroke="#334155" stroke-width="1.5"/>
  <text x="450" y="275" text-anchor="middle" font-family="sans-serif" font-size="11" font-weight="bold" fill="#f1f5f9">出力レポート と 活用場面</text>

  <rect x="30" y="288" width="200" height="60" rx="5" fill="#0f172a" stroke="#ef4444" stroke-width="1"/>
  <text x="130" y="308" text-anchor="middle" font-family="sans-serif" font-size="9" font-weight="bold" fill="#ef4444">Pre-training Bias Report</text>
  <text x="130" y="325" text-anchor="middle" font-family="sans-serif" font-size="8" fill="#94a3b8">データ収集段階でバイアス発見</text>
  <text x="130" y="340" text-anchor="middle" font-family="sans-serif" font-size="8" fill="#94a3b8">→ データ追加・サンプリング改善</text>

  <rect x="250" y="288" width="200" height="60" rx="5" fill="#0f172a" stroke="#f97316" stroke-width="1"/>
  <text x="350" y="308" text-anchor="middle" font-family="sans-serif" font-size="9" font-weight="bold" fill="#f97316">Post-training Bias Report</text>
  <text x="350" y="325" text-anchor="middle" font-family="sans-serif" font-size="8" fill="#94a3b8">モデル出力のバイアス分析</text>
  <text x="350" y="340" text-anchor="middle" font-family="sans-serif" font-size="8" fill="#94a3b8">→ Re-training / 後処理で補正</text>

  <rect x="470" y="288" width="200" height="60" rx="5" fill="#0f172a" stroke="#a855f7" stroke-width="1"/>
  <text x="570" y="308" text-anchor="middle" font-family="sans-serif" font-size="9" font-weight="bold" fill="#a855f7">Explainability Report</text>
  <text x="570" y="325" text-anchor="middle" font-family="sans-serif" font-size="8" fill="#94a3b8">モデルカード生成に活用</text>
  <text x="570" y="340" text-anchor="middle" font-family="sans-serif" font-size="8" fill="#94a3b8">→ GDPR 35条 説明責任対応</text>

  <rect x="690" y="288" width="175" height="60" rx="5" fill="#0f172a" stroke="#22c55e" stroke-width="1"/>
  <text x="777" y="308" text-anchor="middle" font-family="sans-serif" font-size="9" font-weight="bold" fill="#22c55e">Monitor 統合</text>
  <text x="777" y="325" text-anchor="middle" font-family="sans-serif" font-size="8" fill="#94a3b8">推論時バイアスドリフト</text>
  <text x="777" y="340" text-anchor="middle" font-family="sans-serif" font-size="8" fill="#94a3b8">→ 継続監視・アラート</text>

  <!-- Integration with Model Monitor -->
  <rect x="15" y="385" width="870" height="85" rx="8" fill="#1e293b" stroke="#14b8a6" stroke-width="1.5"/>
  <text x="450" y="405" text-anchor="middle" font-family="sans-serif" font-size="11" font-weight="bold" fill="#14b8a6">Model Monitor との統合 (本番環境)</text>
  <text x="250" y="430" text-anchor="middle" font-family="sans-serif" font-size="9" fill="#f1f5f9">BiasMonitoringJob</text>
  <text x="250" y="447" text-anchor="middle" font-family="sans-serif" font-size="8" fill="#94a3b8">推論データの継続的バイアス監視</text>
  <text x="550" y="430" text-anchor="middle" font-family="sans-serif" font-size="9" fill="#f1f5f9">ExplainabilityMonitoringJob</text>
  <text x="550" y="447" text-anchor="middle" font-family="sans-serif" font-size="8" fill="#94a3b8">SHAP値の経時的ドリフト検出</text>
  <text x="450" y="462" text-anchor="middle" font-family="sans-serif" font-size="9" fill="#f97316">試験ポイント: Clarify は SageMaker Processing Job として動作 — スタンドアロン分析も可能</text>
</svg>

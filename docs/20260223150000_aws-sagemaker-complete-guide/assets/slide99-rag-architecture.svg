<svg viewBox="0 0 900 500" style="max-height:70vh;width:auto;display:block;margin:0 auto;letter-spacing:0" xmlns="http://www.w3.org/2000/svg">
  <rect width="900" height="500" fill="#0f172a"/>
  <text x="450" y="24" text-anchor="middle" fill="#f1f5f9" font-size="16" font-weight="bold" font-family="sans-serif">RAG アーキテクチャ (Bedrock + SageMaker)</text>

  <!-- Divider -->
  <line x1="450" y1="38" x2="450" y2="420" stroke="#334155" stroke-width="1" stroke-dasharray="6,4"/>
  <text x="220" y="52" text-anchor="middle" fill="#3b82f6" font-size="12" font-weight="bold" font-family="sans-serif">インジェスチョンパイプライン</text>
  <text x="680" y="52" text-anchor="middle" fill="#22c55e" font-size="12" font-weight="bold" font-family="sans-serif">クエリパイプライン</text>

  <!-- LEFT SIDE: Ingestion Pipeline -->
  <!-- Document Corpus -->
  <rect x="20" y="65" width="130" height="50" rx="8" fill="#1e293b" stroke="#3b82f6" stroke-width="2"/>
  <text x="85" y="87" text-anchor="middle" fill="#94a3b8" font-size="10" font-family="sans-serif">Document Corpus</text>
  <text x="85" y="103" text-anchor="middle" fill="#3b82f6" font-size="10" font-weight="bold" font-family="sans-serif">S3 バケット</text>

  <line x1="150" y1="90" x2="175" y2="90" stroke="#3b82f6" stroke-width="2"/>
  <polygon points="175,86 183,90 175,94" fill="#3b82f6"/>

  <!-- Processing (chunking) -->
  <rect x="183" y="65" width="130" height="50" rx="8" fill="#1e293b" stroke="#a855f7" stroke-width="2"/>
  <text x="248" y="87" text-anchor="middle" fill="#94a3b8" font-size="10" font-family="sans-serif">SageMaker</text>
  <text x="248" y="100" text-anchor="middle" fill="#a855f7" font-size="9" font-weight="bold" font-family="sans-serif">Processing Job</text>
  <text x="248" y="112" text-anchor="middle" fill="#94a3b8" font-size="9" font-family="sans-serif">チャンキング</text>

  <line x1="313" y1="90" x2="340" y2="90" stroke="#a855f7" stroke-width="2"/>
  <polygon points="340,86 348,90 340,94" fill="#a855f7"/>

  <!-- Embedding model -->
  <rect x="348" y="65" width="85" height="50" rx="8" fill="#1e293b" stroke="#f97316" stroke-width="2"/>
  <text x="390" y="87" text-anchor="middle" fill="#94a3b8" font-size="9" font-family="sans-serif">Embedding</text>
  <text x="390" y="100" text-anchor="middle" fill="#f97316" font-size="9" font-weight="bold" font-family="sans-serif">Model</text>
  <text x="390" y="112" text-anchor="middle" fill="#94a3b8" font-size="8" font-family="sans-serif">JumpStart/Bedrock</text>

  <line x1="390" y1="115" x2="390" y2="145" stroke="#f97316" stroke-width="2"/>
  <polygon points="386,145 390,153 394,145" fill="#f97316"/>

  <!-- Vector Store -->
  <rect x="280" y="153" width="220" height="75" rx="8" fill="#1e293b" stroke="#14b8a6" stroke-width="2"/>
  <text x="390" y="175" text-anchor="middle" fill="#94a3b8" font-size="11" font-family="sans-serif">Vector Store</text>
  <text x="390" y="192" text-anchor="middle" fill="#14b8a6" font-size="10" font-weight="bold" font-family="sans-serif">OpenSearch Serverless</text>
  <text x="390" y="206" text-anchor="middle" fill="#94a3b8" font-size="9" font-family="sans-serif">または pgvector (RDS)</text>
  <text x="390" y="220" text-anchor="middle" fill="#94a3b8" font-size="9" font-family="sans-serif">ベクトルインデックス</text>

  <!-- Hybrid search label -->
  <rect x="20" y="253" width="420" height="50" rx="6" fill="#1e293b" stroke="#334155" stroke-width="1"/>
  <text x="230" y="272" text-anchor="middle" fill="#fbbf24" font-size="11" font-weight="bold" font-family="sans-serif">ハイブリッド検索</text>
  <text x="30" y="291" fill="#94a3b8" font-size="10" font-family="sans-serif">Semantic Search (ベクトル類似度) + Keyword Search (BM25/Lexical) の組み合わせ</text>

  <!-- Re-ranking -->
  <rect x="20" y="315" width="420" height="45" rx="6" fill="#1e293b" stroke="#334155" stroke-width="1"/>
  <text x="230" y="333" text-anchor="middle" fill="#a855f7" font-size="11" font-weight="bold" font-family="sans-serif">Re-ranking (オプション)</text>
  <text x="30" y="350" fill="#94a3b8" font-size="10" font-family="sans-serif">Cross-encoder で検索結果の順位を再評価 → 精度向上</text>

  <!-- RIGHT SIDE: Query Pipeline -->
  <!-- User -->
  <rect x="470" y="65" width="100" height="50" rx="8" fill="#1e293b" stroke="#22c55e" stroke-width="2"/>
  <text x="520" y="87" text-anchor="middle" fill="#94a3b8" font-size="10" font-family="sans-serif">ユーザー</text>
  <text x="520" y="103" text-anchor="middle" fill="#22c55e" font-size="10" font-weight="bold" font-family="sans-serif">クエリ入力</text>

  <line x1="570" y1="90" x2="600" y2="90" stroke="#22c55e" stroke-width="2"/>
  <polygon points="600,86 608,90 600,94" fill="#22c55e"/>

  <!-- Query Embedding -->
  <rect x="608" y="65" width="100" height="50" rx="8" fill="#1e293b" stroke="#f97316" stroke-width="2"/>
  <text x="658" y="87" text-anchor="middle" fill="#94a3b8" font-size="10" font-family="sans-serif">Embedding</text>
  <text x="658" y="100" text-anchor="middle" fill="#f97316" font-size="9" font-weight="bold" font-family="sans-serif">Model</text>
  <text x="658" y="112" text-anchor="middle" fill="#94a3b8" font-size="8" font-family="sans-serif">クエリ→ベクトル化</text>

  <line x1="708" y1="90" x2="750" y2="90" stroke="#f97316" stroke-width="2"/>
  <polygon points="750,86 758,90 750,94" fill="#f97316"/>

  <!-- Query vector to vector store -->
  <rect x="758" y="65" width="125" height="50" rx="8" fill="#1e293b" stroke="#14b8a6" stroke-width="2"/>
  <text x="820" y="87" text-anchor="middle" fill="#94a3b8" font-size="10" font-family="sans-serif">Vector Store</text>
  <text x="820" y="100" text-anchor="middle" fill="#14b8a6" font-size="9" font-weight="bold" font-family="sans-serif">Semantic Search</text>
  <text x="820" y="112" text-anchor="middle" fill="#94a3b8" font-size="8" font-family="sans-serif">Top-K 類似チャンク</text>

  <line x1="820" y1="115" x2="820" y2="153" stroke="#14b8a6" stroke-width="2"/>
  <polygon points="816,153 820,161 824,153" fill="#14b8a6"/>

  <!-- Retrieved Context -->
  <rect x="680" y="161" width="200" height="55" rx="8" fill="#1e293b" stroke="#3b82f6" stroke-width="2"/>
  <text x="780" y="182" text-anchor="middle" fill="#94a3b8" font-size="10" font-family="sans-serif">Retrieved Context</text>
  <text x="780" y="198" text-anchor="middle" fill="#3b82f6" font-size="9" font-family="sans-serif">取得コンテキスト + 元クエリ</text>
  <text x="780" y="212" text-anchor="middle" fill="#94a3b8" font-size="9" font-family="sans-serif">→ プロンプト構築</text>

  <line x1="780" y1="216" x2="780" y2="250" stroke="#3b82f6" stroke-width="2"/>
  <polygon points="776,250 780,258 784,250" fill="#3b82f6"/>

  <!-- LLM -->
  <rect x="650" y="258" width="240" height="70" rx="8" fill="#1e293b" stroke="#a855f7" stroke-width="2"/>
  <text x="770" y="280" text-anchor="middle" fill="#94a3b8" font-size="10" font-family="sans-serif">LLM</text>
  <text x="770" y="296" text-anchor="middle" fill="#a855f7" font-size="11" font-weight="bold" font-family="sans-serif">Bedrock Claude/Llama</text>
  <text x="770" y="312" text-anchor="middle" fill="#94a3b8" font-size="9" font-family="sans-serif">または SageMaker Endpoint</text>
  <text x="770" y="325" text-anchor="middle" fill="#94a3b8" font-size="9" font-family="sans-serif">(JumpStart FM)</text>

  <line x1="770" y1="328" x2="770" y2="360" stroke="#a855f7" stroke-width="2"/>
  <polygon points="766,360 770,368 774,360" fill="#a855f7"/>

  <!-- Answer -->
  <rect x="650" y="368" width="240" height="45" rx="8" fill="#1e293b" stroke="#22c55e" stroke-width="2"/>
  <text x="770" y="388" text-anchor="middle" fill="#94a3b8" font-size="10" font-family="sans-serif">Generated Answer</text>
  <text x="770" y="403" text-anchor="middle" fill="#22c55e" font-size="10" font-weight="bold" font-family="sans-serif">ユーザーへ返却</text>

  <!-- Benefits box -->
  <rect x="460" y="430" width="430" height="60" rx="8" fill="#1e293b"/>
  <text x="675" y="448" text-anchor="middle" fill="#fbbf24" font-size="11" font-weight="bold" font-family="sans-serif">RAG のメリット</text>
  <text x="470" y="465" fill="#94a3b8" font-size="10" font-family="sans-serif">- LLM の知識カットオフを超えた最新情報参照</text>
  <text x="470" y="480" fill="#94a3b8" font-size="10" font-family="sans-serif">- ハルシネーション低減 - ソース追跡可能 - ファインチューニング不要</text>

  <!-- Cross-pipeline arrow (vector store shared) -->
  <line x1="500" y1="190" x2="680" y2="190" stroke="#14b8a6" stroke-width="1.5" stroke-dasharray="4,3"/>
  <text x="588" y="183" text-anchor="middle" fill="#14b8a6" font-size="9" font-family="sans-serif">共有 Vector DB</text>
</svg>

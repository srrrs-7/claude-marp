<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 960 480" style="max-height:70vh;width:auto;display:block;margin:0 auto;letter-spacing:0;background:#0d1117" font-family="sans-serif">
  <rect width="960" height="480" fill="#0d1117"/>

  <!-- Title -->
  <text x="480" y="28" text-anchor="middle" fill="#e6edf3" font-size="18" font-weight="bold">Positional Encoding — 位置情報の埋め込み</text>

  <!-- ===== LEFT: Formula and Heatmap ===== -->
  <!-- Formula box -->
  <rect x="30" y="45" width="420" height="75" rx="6" fill="#0f1520" stroke="#818cf8" stroke-width="1.5"/>
  <text x="240" y="65" text-anchor="middle" fill="#c4b5fd" font-size="12" font-weight="bold">Sinusoidal Positional Encoding</text>
  <text x="240" y="86" text-anchor="middle" fill="#e6edf3" font-size="11">PE(pos, 2i)   = sin(pos / 10000^(2i/d_model))</text>
  <text x="240" y="106" text-anchor="middle" fill="#e6edf3" font-size="11">PE(pos, 2i+1) = cos(pos / 10000^(2i/d_model))</text>

  <!-- Heatmap label -->
  <text x="240" y="140" text-anchor="middle" fill="#94a3b8" font-size="11">PE行列ヒートマップ (pos 0-15, dim 0-15)</text>

  <!-- Heatmap grid: 16 cols (dimensions) x 16 rows (positions) -->
  <!-- Cell size: 24x16, start x=30, y=148 -->
  <!-- Pre-computed sinusoidal values converted to colors -->
  <!-- Row 0 (pos=0): all 0 for sin, all 1 for cos alternating -->

  <!-- Using simplified color coding: warm = positive, cool = negative -->
  <!-- Row pos=0 -->
  <rect x="30" y="150" width="24" height="16" fill="#1a4a8a"/><rect x="54" y="150" width="24" height="16" fill="#4169aa"/><rect x="78" y="150" width="24" height="16" fill="#1a3a8a"/><rect x="102" y="150" width="24" height="16" fill="#2a5aaa"/><rect x="126" y="150" width="24" height="16" fill="#1a4a8a"/><rect x="150" y="150" width="24" height="16" fill="#3a6aaa"/><rect x="174" y="150" width="24" height="16" fill="#1a4a8a"/><rect x="198" y="150" width="24" height="16" fill="#4080aa"/>
  <rect x="222" y="150" width="24" height="16" fill="#1a4a8a"/><rect x="246" y="150" width="24" height="16" fill="#4580ba"/><rect x="270" y="150" width="24" height="16" fill="#1a4a8a"/><rect x="294" y="150" width="24" height="16" fill="#4080aa"/><rect x="318" y="150" width="24" height="16" fill="#1a4a8a"/><rect x="342" y="150" width="24" height="16" fill="#3a70aa"/><rect x="366" y="150" width="24" height="16" fill="#1a4a8a"/><rect x="390" y="150" width="24" height="16" fill="#2a60aa"/>

  <!-- Row pos=1: sin(1/...) values -->
  <rect x="30" y="166" width="24" height="16" fill="#8a3a10"/><rect x="54" y="166" width="24" height="16" fill="#3a70aa"/><rect x="78" y="166" width="24" height="16" fill="#7a2a00"/><rect x="102" y="166" width="24" height="16" fill="#2a60aa"/><rect x="126" y="166" width="24" height="16" fill="#4a1500"/><rect x="150" y="166" width="24" height="16" fill="#2a58aa"/><rect x="174" y="166" width="24" height="16" fill="#2a0800"/><rect x="198" y="166" width="24" height="16" fill="#2a55aa"/>
  <rect x="222" y="166" width="24" height="16" fill="#1a2000"/><rect x="246" y="166" width="24" height="16" fill="#2a52aa"/><rect x="270" y="166" width="24" height="16" fill="#1a1800"/><rect x="294" y="166" width="24" height="16" fill="#2a50aa"/><rect x="318" y="166" width="24" height="16" fill="#1a1600"/><rect x="342" y="166" width="24" height="16" fill="#2a4faa"/><rect x="366" y="166" width="24" height="16" fill="#1a1500"/><rect x="390" y="166" width="24" height="16" fill="#2a4faa"/>

  <!-- Row pos=2 -->
  <rect x="30" y="182" width="24" height="16" fill="#c05010"/><rect x="54" y="182" width="24" height="16" fill="#2a60aa"/><rect x="78" y="182" width="24" height="16" fill="#a04000"/><rect x="102" y="182" width="24" height="16" fill="#2a50aa"/><rect x="126" y="182" width="24" height="16" fill="#602000"/><rect x="150" y="182" width="24" height="16" fill="#2a4faa"/><rect x="174" y="182" width="24" height="16" fill="#301000"/><rect x="198" y="182" width="24" height="16" fill="#2a4eaa"/>
  <rect x="222" y="182" width="24" height="16" fill="#200800"/><rect x="246" y="182" width="24" height="16" fill="#2a4daa"/><rect x="270" y="182" width="24" height="16" fill="#180500"/><rect x="294" y="182" width="24" height="16" fill="#2a4daa"/><rect x="318" y="182" width="24" height="16" fill="#150400"/><rect x="342" y="182" width="24" height="16" fill="#2a4daa"/><rect x="366" y="182" width="24" height="16" fill="#130300"/><rect x="390" y="182" width="24" height="16" fill="#2a4caa"/>

  <!-- Row pos=3 -->
  <rect x="30" y="198" width="24" height="16" fill="#e06010"/><rect x="54" y="198" width="24" height="16" fill="#2050aa"/><rect x="78" y="198" width="24" height="16" fill="#c04a00"/><rect x="102" y="198" width="24" height="16" fill="#2048aa"/><rect x="126" y="198" width="24" height="16" fill="#804000"/><rect x="150" y="198" width="24" height="16" fill="#2046aa"/><rect x="174" y="198" width="24" height="16" fill="#482000"/><rect x="198" y="198" width="24" height="16" fill="#2045aa"/>
  <rect x="222" y="198" width="24" height="16" fill="#300e00"/><rect x="246" y="198" width="24" height="16" fill="#2044aa"/><rect x="270" y="198" width="24" height="16" fill="#1a0800"/><rect x="294" y="198" width="24" height="16" fill="#2043aa"/><rect x="318" y="198" width="24" height="16" fill="#150500"/><rect x="342" y="198" width="24" height="16" fill="#2042aa"/><rect x="366" y="198" width="24" height="16" fill="#120400"/><rect x="390" y="198" width="24" height="16" fill="#2042aa"/>

  <!-- Row pos=4-7 (faster oscillation) -->
  <rect x="30" y="214" width="24" height="16" fill="#f07020"/><rect x="54" y="214" width="24" height="16" fill="#1a40aa"/><rect x="78" y="214" width="24" height="16" fill="#d05800"/><rect x="102" y="214" width="24" height="16" fill="#1a3caa"/><rect x="126" y="214" width="24" height="16" fill="#b04800"/><rect x="150" y="214" width="24" height="16" fill="#1a3baa"/><rect x="174" y="214" width="24" height="16" fill="#602800"/><rect x="198" y="214" width="24" height="16" fill="#1a3aaa"/>
  <rect x="222" y="214" width="24" height="16" fill="#3a1000"/><rect x="246" y="214" width="24" height="16" fill="#1a39aa"/><rect x="270" y="214" width="24" height="16" fill="#200a00"/><rect x="294" y="214" width="24" height="16" fill="#1a38aa"/><rect x="318" y="214" width="24" height="16" fill="#170600"/><rect x="342" y="214" width="24" height="16" fill="#1a38aa"/><rect x="366" y="214" width="24" height="16" fill="#130400"/><rect x="390" y="214" width="24" height="16" fill="#1a38aa"/>

  <rect x="30" y="230" width="24" height="16" fill="#f08030"/><rect x="54" y="230" width="24" height="16" fill="#1438aa"/><rect x="78" y="230" width="24" height="16" fill="#e07020"/><rect x="102" y="230" width="24" height="16" fill="#1436aa"/><rect x="126" y="230" width="24" height="16" fill="#d05000"/><rect x="150" y="230" width="24" height="16" fill="#1435aa"/><rect x="174" y="230" width="24" height="16" fill="#804000"/><rect x="198" y="230" width="24" height="16" fill="#1434aa"/>
  <rect x="222" y="230" width="24" height="16" fill="#481800"/><rect x="246" y="230" width="24" height="16" fill="#1434aa"/><rect x="270" y="230" width="24" height="16" fill="#280c00"/><rect x="294" y="230" width="24" height="16" fill="#1433aa"/><rect x="318" y="230" width="24" height="16" fill="#1a0700"/><rect x="342" y="230" width="24" height="16" fill="#1433aa"/><rect x="366" y="230" width="24" height="16" fill="#150500"/><rect x="390" y="230" width="24" height="16" fill="#1432aa"/>

  <rect x="30" y="246" width="24" height="16" fill="#a05020"/><rect x="54" y="246" width="24" height="16" fill="#1030aa"/><rect x="78" y="246" width="24" height="16" fill="#e08030"/><rect x="102" y="246" width="24" height="16" fill="#102eaa"/><rect x="126" y="246" width="24" height="16" fill="#e06000"/><rect x="150" y="246" width="24" height="16" fill="#1030aa"/><rect x="174" y="246" width="24" height="16" fill="#a04800"/><rect x="198" y="246" width="24" height="16" fill="#102daa"/>
  <rect x="222" y="246" width="24" height="16" fill="#602a00"/><rect x="246" y="246" width="24" height="16" fill="#102caa"/><rect x="270" y="246" width="24" height="16" fill="#301200"/><rect x="294" y="246" width="24" height="16" fill="#102caa"/><rect x="318" y="246" width="24" height="16" fill="#1c0800"/><rect x="342" y="246" width="24" height="16" fill="#102baa"/><rect x="366" y="246" width="24" height="16" fill="#160500"/><rect x="390" y="246" width="24" height="16" fill="#102baa"/>

  <rect x="30" y="262" width="24" height="16" fill="#304060"/><rect x="54" y="262" width="24" height="16" fill="#0c28aa"/><rect x="78" y="262" width="24" height="16" fill="#c07030"/><rect x="102" y="262" width="24" height="16" fill="#0c27aa"/><rect x="126" y="262" width="24" height="16" fill="#e08020"/><rect x="150" y="262" width="24" height="16" fill="#0c27aa"/><rect x="174" y="262" width="24" height="16" fill="#d06800"/><rect x="198" y="262" width="24" height="16" fill="#0c26aa"/>
  <rect x="222" y="262" width="24" height="16" fill="#783800"/><rect x="246" y="262" width="24" height="16" fill="#0c26aa"/><rect x="270" y="262" width="24" height="16" fill="#3c1800"/><rect x="294" y="262" width="24" height="16" fill="#0c25aa"/><rect x="318" y="262" width="24" height="16" fill="#200b00"/><rect x="342" y="262" width="24" height="16" fill="#0c25aa"/><rect x="366" y="262" width="24" height="16" fill="#160600"/><rect x="390" y="262" width="24" height="16" fill="#0c25aa"/>

  <!-- rows 8-15 (lower freq dims, slow change) -->
  <rect x="30" y="278" width="24" height="16" fill="#1a3070"/><rect x="54" y="278" width="24" height="16" fill="#3070c0"/><rect x="78" y="278" width="24" height="16" fill="#903820"/><rect x="102" y="278" width="24" height="16" fill="#2068b8"/><rect x="126" y="278" width="24" height="16" fill="#e09030"/><rect x="150" y="278" width="24" height="16" fill="#1865b5"/><rect x="174" y="278" width="24" height="16" fill="#e07800"/><rect x="198" y="278" width="24" height="16" fill="#1563b3"/>
  <rect x="222" y="278" width="24" height="16" fill="#9a4800"/><rect x="246" y="278" width="24" height="16" fill="#1462b2"/><rect x="270" y="278" width="24" height="16" fill="#4c2000"/><rect x="294" y="278" width="24" height="16" fill="#1361b1"/><rect x="318" y="278" width="24" height="16" fill="#261000"/><rect x="342" y="278" width="24" height="16" fill="#1360b1"/><rect x="366" y="278" width="24" height="16" fill="#180800"/><rect x="390" y="278" width="24" height="16" fill="#1260b0"/>

  <!-- rows 9-15 similar pattern but slower -->
  <rect x="30" y="294" width="24" height="16" fill="#1a2858"/><rect x="54" y="294" width="24" height="16" fill="#2868ba"/><rect x="78" y="294" width="24" height="16" fill="#683018"/><rect x="102" y="294" width="24" height="16" fill="#2065b7"/><rect x="126" y="294" width="24" height="16" fill="#d08830"/><rect x="150" y="294" width="24" height="16" fill="#1862b4"/><rect x="174" y="294" width="24" height="16" fill="#e07500"/><rect x="198" y="294" width="24" height="16" fill="#1561b3"/>
  <rect x="222" y="294" width="24" height="16" fill="#9a4a02"/><rect x="246" y="294" width="24" height="16" fill="#1460b2"/><rect x="270" y="294" width="24" height="16" fill="#4c2200"/><rect x="294" y="294" width="24" height="16" fill="#135fb1"/><rect x="318" y="294" width="24" height="16" fill="#261200"/><rect x="342" y="294" width="24" height="16" fill="#125eb0"/><rect x="366" y="294" width="24" height="16" fill="#180900"/><rect x="390" y="294" width="24" height="16" fill="#125eb0"/>

  <rect x="30" y="310" width="24" height="16" fill="#1a2050"/><rect x="54" y="310" width="24" height="16" fill="#2060b5"/><rect x="78" y="310" width="24" height="16" fill="#482810"/><rect x="102" y="310" width="24" height="16" fill="#1860b4"/><rect x="126" y="310" width="24" height="16" fill="#b07828"/><rect x="150" y="310" width="24" height="16" fill="#165fb3"/><rect x="174" y="310" width="24" height="16" fill="#d07200"/><rect x="198" y="310" width="24" height="16" fill="#155eb2"/>
  <rect x="222" y="310" width="24" height="16" fill="#8a4202"/><rect x="246" y="310" width="24" height="16" fill="#145db1"/><rect x="270" y="310" width="24" height="16" fill="#461e00"/><rect x="294" y="310" width="24" height="16" fill="#135cb0"/><rect x="318" y="310" width="24" height="16" fill="#241000"/><rect x="342" y="310" width="24" height="16" fill="#125baf"/><rect x="366" y="310" width="24" height="16" fill="#170800"/><rect x="390" y="310" width="24" height="16" fill="#125baf"/>

  <rect x="30" y="326" width="24" height="16" fill="#1a1848"/><rect x="54" y="326" width="24" height="16" fill="#1858b0"/><rect x="78" y="326" width="24" height="16" fill="#30200a"/><rect x="102" y="326" width="24" height="16" fill="#165baf"/><rect x="126" y="326" width="24" height="16" fill="#906820"/><rect x="150" y="326" width="24" height="16" fill="#155aae"/><rect x="174" y="326" width="24" height="16" fill="#c06800"/><rect x="198" y="326" width="24" height="16" fill="#1459ad"/>
  <rect x="222" y="326" width="24" height="16" fill="#7a3c00"/><rect x="246" y="326" width="24" height="16" fill="#1358ac"/><rect x="270" y="326" width="24" height="16" fill="#3e1a00"/><rect x="294" y="326" width="24" height="16" fill="#1257ab"/><rect x="318" y="326" width="24" height="16" fill="#200d00"/><rect x="342" y="326" width="24" height="16" fill="#1256aa"/><rect x="366" y="326" width="24" height="16" fill="#160700"/><rect x="390" y="326" width="24" height="16" fill="#1255aa"/>

  <rect x="30" y="342" width="24" height="16" fill="#1a1240"/><rect x="54" y="342" width="24" height="16" fill="#1250a8"/><rect x="78" y="342" width="24" height="16" fill="#201808"/><rect x="102" y="342" width="24" height="16" fill="#1052a8"/><rect x="126" y="342" width="24" height="16" fill="#705818"/><rect x="150" y="342" width="24" height="16" fill="#1051a7"/><rect x="174" y="342" width="24" height="16" fill="#b05c00"/><rect x="198" y="342" width="24" height="16" fill="#0f50a6"/>
  <rect x="222" y="342" width="24" height="16" fill="#6c3600"/><rect x="246" y="342" width="24" height="16" fill="#0f4fa5"/><rect x="270" y="342" width="24" height="16" fill="#381600"/><rect x="294" y="342" width="24" height="16" fill="#0e4ea4"/><rect x="318" y="342" width="24" height="16" fill="#1c0c00"/><rect x="342" y="342" width="24" height="16" fill="#0e4da4"/><rect x="366" y="342" width="24" height="16" fill="#140600"/><rect x="390" y="342" width="24" height="16" fill="#0e4da3"/>

  <!-- Axis labels -->
  <text x="240" y="376" text-anchor="middle" fill="#94a3b8" font-size="10">次元 (dimension) →</text>
  <text x="18" y="255" text-anchor="middle" fill="#94a3b8" font-size="10" transform="rotate(-90, 18, 255)">位置 (pos) →</text>

  <!-- Color legend -->
  <rect x="30" y="388" width="50" height="12" fill="#f07020"/><text x="88" y="399" fill="#94a3b8" font-size="10">正 (sin+)</text>
  <rect x="135" y="388" width="50" height="12" fill="#1a4a8a"/><text x="193" y="399" fill="#94a3b8" font-size="10">負/cos</text>
  <rect x="235" y="388" width="50" height="12" fill="#0d1117" stroke="#30363d" stroke-width="1"/><text x="293" y="399" fill="#94a3b8" font-size="10">低周波</text>

  <!-- ===== RIGHT: Timeline ===== -->
  <text x="720" y="55" text-anchor="middle" fill="#e6edf3" font-size="14" font-weight="bold">PE の進化</text>

  <!-- Timeline line -->
  <line x1="570" y1="75" x2="570" y2="415" stroke="#30363d" stroke-width="2"/>

  <!-- 2017: Sinusoidal -->
  <circle cx="570" cy="90" r="8" fill="#f97316" style="filter: drop-shadow(2px 2px 3px rgba(0,0,0,0.5))"/>
  <rect x="588" y="74" width="330" height="40" rx="4" fill="#1c1108" stroke="#f97316" stroke-width="1.5"/>
  <text x="600" y="91" fill="#f97316" font-size="11" font-weight="bold">2017: Sinusoidal PE (Vaswani et al.)</text>
  <text x="600" y="107" fill="#94a3b8" font-size="10">sin/cos関数で位置を固定的にエンコード</text>

  <!-- 2018: Learned PE -->
  <circle cx="570" cy="150" r="8" fill="#3b82f6" style="filter: drop-shadow(2px 2px 3px rgba(0,0,0,0.5))"/>
  <rect x="588" y="134" width="330" height="40" rx="4" fill="#0a1628" stroke="#3b82f6" stroke-width="1.5"/>
  <text x="600" y="151" fill="#3b82f6" font-size="11" font-weight="bold">2018: Learned PE (GPT / BERT)</text>
  <text x="600" y="167" fill="#94a3b8" font-size="10">位置埋め込みをデータから学習</text>

  <!-- 2021: RoPE -->
  <circle cx="570" cy="210" r="8" fill="#22c55e" style="filter: drop-shadow(2px 2px 3px rgba(0,0,0,0.5))"/>
  <rect x="588" y="194" width="330" height="50" rx="4" fill="#0a2010" stroke="#22c55e" stroke-width="1.5"/>
  <text x="600" y="211" fill="#22c55e" font-size="11" font-weight="bold">2021: RoPE — Rotary PE (Su et al.)</text>
  <text x="600" y="227" fill="#94a3b8" font-size="10">回転行列で相対位置を表現。LLaMA/GPT-NeoXで採用</text>
  <text x="600" y="240" fill="#94a3b8" font-size="9">q_rot = q · cos(θ) + rotate(q) · sin(θ)</text>

  <!-- 2022: ALiBi -->
  <circle cx="570" cy="280" r="8" fill="#a78bfa" style="filter: drop-shadow(2px 2px 3px rgba(0,0,0,0.5))"/>
  <rect x="588" y="264" width="330" height="50" rx="4" fill="#1a1028" stroke="#a78bfa" stroke-width="1.5"/>
  <text x="600" y="281" fill="#a78bfa" font-size="11" font-weight="bold">2022: ALiBi — Attention with Linear Biases</text>
  <text x="600" y="297" fill="#94a3b8" font-size="10">Attentionスコアに線形バイアスを付加</text>
  <text x="600" y="310" fill="#94a3b8" font-size="9">longer context外挿に強い (Press et al.)</text>

  <!-- 2023+: YaRN / LongRoPE -->
  <circle cx="570" cy="350" r="8" fill="#f472b6" style="filter: drop-shadow(2px 2px 3px rgba(0,0,0,0.5))"/>
  <rect x="588" y="334" width="330" height="50" rx="4" fill="#2d0a1e" stroke="#f472b6" stroke-width="1.5"/>
  <text x="600" y="351" fill="#f472b6" font-size="11" font-weight="bold">2023+: YaRN / LongRoPE</text>
  <text x="600" y="367" fill="#94a3b8" font-size="10">RoPEを長コンテキスト向けに拡張</text>
  <text x="600" y="380" fill="#94a3b8" font-size="9">LLaMA-3 128K, Gemini 1M+ コンテキスト対応</text>

  <!-- Future arrow -->
  <line x1="570" y1="388" x2="570" y2="415" stroke="#30363d" stroke-width="2" stroke-dasharray="5,3"/>
  <polygon points="565,413 570,423 575,413" fill="#30363d"/>

  <!-- Bottom note -->
  <rect x="30" y="430" width="900" height="40" rx="5" fill="#0f1520" stroke="#30363d" stroke-width="1"/>
  <text x="480" y="448" text-anchor="middle" fill="#94a3b8" font-size="11">Transformerは位置情報を持たないため、PE必須  |  Sinusoidal: 外挿可能・学習不要  |  RoPE/ALiBi: 長コンテキストで優位</text>
  <text x="480" y="464" text-anchor="middle" fill="#94a3b8" font-size="10">token embedding + positional encoding → 入力表現</text>
</svg>

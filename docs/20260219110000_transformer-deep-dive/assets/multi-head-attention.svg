<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 960 480" style="max-height:70vh;width:auto;display:block;margin:0 auto;letter-spacing:0;background:#0d1117" font-family="sans-serif">
  <rect width="960" height="480" fill="#0d1117"/>

  <!-- Title -->
  <text x="480" y="28" text-anchor="middle" fill="#e6edf3" font-size="18" font-weight="bold">Multi-Head Attention — h個のAttentionヘッド</text>

  <!-- ===== INPUT Q, K, V ===== -->
  <rect x="60" y="50" width="70" height="38" rx="4" fill="#1c1108" stroke="#f97316" stroke-width="2"/>
  <text x="95" y="74" text-anchor="middle" fill="#f97316" font-size="14" font-weight="bold">Q</text>

  <rect x="60" y="100" width="70" height="38" rx="4" fill="#0a1628" stroke="#3b82f6" stroke-width="2"/>
  <text x="95" y="124" text-anchor="middle" fill="#3b82f6" font-size="14" font-weight="bold">K</text>

  <rect x="60" y="150" width="70" height="38" rx="4" fill="#0a2010" stroke="#22c55e" stroke-width="2"/>
  <text x="95" y="174" text-anchor="middle" fill="#22c55e" font-size="14" font-weight="bold">V</text>

  <!-- Fan-out lines to 4 heads -->
  <!-- Head 1 (orange) -->
  <line x1="130" y1="95" x2="195" y2="95" stroke="#f97316" stroke-width="1.5"/>
  <line x1="195" y1="95" x2="195" y2="80" stroke="#f97316" stroke-width="1.5"/>
  <line x1="195" y1="80" x2="225" y2="80" stroke="#f97316" stroke-width="1.5"/>

  <line x1="130" y1="119" x2="185" y2="119" stroke="#3b82f6" stroke-width="1.5"/>
  <line x1="185" y1="119" x2="185" y2="87" stroke="#3b82f6" stroke-width="1.5"/>
  <line x1="185" y1="87" x2="225" y2="87" stroke="#3b82f6" stroke-width="1.5"/>

  <line x1="130" y1="169" x2="180" y2="169" stroke="#22c55e" stroke-width="1.5"/>
  <line x1="180" y1="169" x2="180" y2="94" stroke="#22c55e" stroke-width="1.5"/>
  <line x1="180" y1="94" x2="225" y2="94" stroke="#22c55e" stroke-width="1.5"/>

  <!-- Head 2 (blue) -->
  <line x1="130" y1="95" x2="195" y2="95" stroke="#f97316" stroke-width="1.5"/>
  <line x1="195" y1="95" x2="195" y2="175" stroke="#f97316" stroke-width="0.8" stroke-dasharray="3,2"/>
  <line x1="195" y1="175" x2="225" y2="175" stroke="#f97316" stroke-width="1.5"/>

  <line x1="130" y1="119" x2="185" y2="119" stroke="#3b82f6" stroke-width="1.5"/>
  <line x1="185" y1="119" x2="185" y2="182" stroke="#3b82f6" stroke-width="0.8" stroke-dasharray="3,2"/>
  <line x1="185" y1="182" x2="225" y2="182" stroke="#3b82f6" stroke-width="1.5"/>

  <line x1="130" y1="169" x2="180" y2="169" stroke="#22c55e" stroke-width="1.5"/>
  <line x1="180" y1="169" x2="180" y2="189" stroke="#22c55e" stroke-width="0.8" stroke-dasharray="3,2"/>
  <line x1="180" y1="189" x2="225" y2="189" stroke="#22c55e" stroke-width="1.5"/>

  <!-- Head 3 (green) -->
  <line x1="195" y1="95" x2="195" y2="270" stroke="#f97316" stroke-width="0.8" stroke-dasharray="3,2"/>
  <line x1="195" y1="270" x2="225" y2="270" stroke="#f97316" stroke-width="1.5"/>

  <line x1="185" y1="119" x2="185" y2="277" stroke="#3b82f6" stroke-width="0.8" stroke-dasharray="3,2"/>
  <line x1="185" y1="277" x2="225" y2="277" stroke="#3b82f6" stroke-width="1.5"/>

  <line x1="180" y1="169" x2="180" y2="284" stroke="#22c55e" stroke-width="0.8" stroke-dasharray="3,2"/>
  <line x1="180" y1="284" x2="225" y2="284" stroke="#22c55e" stroke-width="1.5"/>

  <!-- Head 4 (purple) -->
  <line x1="195" y1="95" x2="195" y2="365" stroke="#f97316" stroke-width="0.8" stroke-dasharray="3,2"/>
  <line x1="195" y1="365" x2="225" y2="365" stroke="#f97316" stroke-width="1.5"/>

  <line x1="185" y1="119" x2="185" y2="372" stroke="#3b82f6" stroke-width="0.8" stroke-dasharray="3,2"/>
  <line x1="185" y1="372" x2="225" y2="372" stroke="#3b82f6" stroke-width="1.5"/>

  <line x1="180" y1="169" x2="180" y2="379" stroke="#22c55e" stroke-width="0.8" stroke-dasharray="3,2"/>
  <line x1="180" y1="379" x2="225" y2="379" stroke="#22c55e" stroke-width="1.5"/>

  <!-- ===== ATTENTION HEADS ===== -->
  <!-- Head 1 -->
  <rect x="225" y="60" width="140" height="55" rx="6" fill="#1c1108" stroke="#f97316" stroke-width="2" style="filter: drop-shadow(2px 2px 4px rgba(0,0,0,0.5))"/>
  <text x="295" y="82" text-anchor="middle" fill="#f97316" font-size="12" font-weight="bold">Head 1</text>
  <text x="295" y="98" text-anchor="middle" fill="#fed7aa" font-size="10">Attention(QW₁^Q, KW₁^K, VW₁^V)</text>
  <text x="295" y="110" text-anchor="middle" fill="#94a3b8" font-size="9">d_k=64</text>

  <!-- Head 2 -->
  <rect x="225" y="155" width="140" height="55" rx="6" fill="#0a1628" stroke="#3b82f6" stroke-width="2" style="filter: drop-shadow(2px 2px 4px rgba(0,0,0,0.5))"/>
  <text x="295" y="177" text-anchor="middle" fill="#3b82f6" font-size="12" font-weight="bold">Head 2</text>
  <text x="295" y="193" text-anchor="middle" fill="#93c5fd" font-size="10">Attention(QW₂^Q, KW₂^K, VW₂^V)</text>
  <text x="295" y="205" text-anchor="middle" fill="#94a3b8" font-size="9">d_k=64</text>

  <!-- Head 3 -->
  <rect x="225" y="250" width="140" height="55" rx="6" fill="#0a2010" stroke="#22c55e" stroke-width="2" style="filter: drop-shadow(2px 2px 4px rgba(0,0,0,0.5))"/>
  <text x="295" y="272" text-anchor="middle" fill="#22c55e" font-size="12" font-weight="bold">Head 3</text>
  <text x="295" y="288" text-anchor="middle" fill="#86efac" font-size="10">Attention(QW₃^Q, KW₃^K, VW₃^V)</text>
  <text x="295" y="300" text-anchor="middle" fill="#94a3b8" font-size="9">d_k=64</text>

  <!-- Head 4 -->
  <rect x="225" y="345" width="140" height="55" rx="6" fill="#1a1028" stroke="#a78bfa" stroke-width="2" style="filter: drop-shadow(2px 2px 4px rgba(0,0,0,0.5))"/>
  <text x="295" y="367" text-anchor="middle" fill="#a78bfa" font-size="12" font-weight="bold">Head 4</text>
  <text x="295" y="383" text-anchor="middle" fill="#ddd6fe" font-size="10">Attention(QW₄^Q, KW₄^K, VW₄^V)</text>
  <text x="295" y="395" text-anchor="middle" fill="#94a3b8" font-size="9">d_k=64</text>

  <!-- Arrows from heads to Concat -->
  <line x1="365" y1="87" x2="410" y2="200" stroke="#f97316" stroke-width="1.5"/>
  <line x1="365" y1="182" x2="410" y2="210" stroke="#3b82f6" stroke-width="1.5"/>
  <line x1="365" y1="277" x2="410" y2="220" stroke="#22c55e" stroke-width="1.5"/>
  <line x1="365" y1="372" x2="410" y2="230" stroke="#a78bfa" stroke-width="1.5"/>

  <!-- ===== CONCAT ===== -->
  <rect x="410" y="155" width="120" height="115" rx="6" fill="#0f1520" stroke="#818cf8" stroke-width="2" style="filter: drop-shadow(2px 2px 4px rgba(0,0,0,0.5))"/>
  <text x="470" y="180" text-anchor="middle" fill="#818cf8" font-size="13" font-weight="bold">Concat</text>
  <!-- Stacked colored rectangles showing concatenation -->
  <rect x="425" y="190" width="80" height="16" rx="2" fill="#f97316" opacity="0.8"/>
  <text x="465" y="202" text-anchor="middle" fill="#fff" font-size="9">head_1 (64)</text>
  <rect x="425" y="208" width="80" height="16" rx="2" fill="#3b82f6" opacity="0.8"/>
  <text x="465" y="220" text-anchor="middle" fill="#fff" font-size="9">head_2 (64)</text>
  <rect x="425" y="226" width="80" height="16" rx="2" fill="#22c55e" opacity="0.8"/>
  <text x="465" y="238" text-anchor="middle" fill="#fff" font-size="9">head_3 (64)</text>
  <rect x="425" y="244" width="80" height="16" rx="2" fill="#a78bfa" opacity="0.8"/>
  <text x="465" y="256" text-anchor="middle" fill="#fff" font-size="9">head_4 (64)</text>

  <!-- Arrow Concat -> Linear -->
  <line x1="530" y1="212" x2="570" y2="212" stroke="#818cf8" stroke-width="1.5"/>
  <polygon points="568,207 578,212 568,217" fill="#818cf8"/>

  <!-- ===== LINEAR (W^O) ===== -->
  <rect x="578" y="175" width="115" height="75" rx="6" fill="#1e1b4b" stroke="#818cf8" stroke-width="2" style="filter: drop-shadow(2px 2px 4px rgba(0,0,0,0.5))"/>
  <text x="635" y="207" text-anchor="middle" fill="#a5b4fc" font-size="13" font-weight="bold">Linear W^O</text>
  <text x="635" y="225" text-anchor="middle" fill="#c4b5fd" font-size="10">d_model × d_model</text>
  <text x="635" y="241" text-anchor="middle" fill="#c4b5fd" font-size="10">(256 → 512)</text>

  <!-- Arrow Linear -> Output -->
  <line x1="693" y1="212" x2="730" y2="212" stroke="#818cf8" stroke-width="1.5"/>
  <polygon points="728,207 738,212 728,217" fill="#818cf8"/>

  <!-- ===== OUTPUT ===== -->
  <rect x="738" y="178" width="130" height="68" rx="6" fill="#0f2a1a" stroke="#22c55e" stroke-width="2" style="filter: drop-shadow(2px 2px 4px rgba(0,0,0,0.5))"/>
  <text x="803" y="204" text-anchor="middle" fill="#86efac" font-size="13" font-weight="bold">Output</text>
  <text x="803" y="222" text-anchor="middle" fill="#86efac" font-size="10">seq_len × d_model</text>
  <text x="803" y="238" text-anchor="middle" fill="#86efac" font-size="10">512 dims</text>

  <!-- ===== FORMULA BOX ===== -->
  <rect x="40" y="418" width="880" height="55" rx="6" fill="#0f1520" stroke="#818cf8" stroke-width="1.5"/>
  <text x="480" y="440" text-anchor="middle" fill="#c4b5fd" font-size="13" font-weight="bold">MultiHead(Q,K,V) = Concat(head₁, ..., headₕ) W^O</text>
  <text x="480" y="462" text-anchor="middle" fill="#94a3b8" font-size="11">各ヘッドが異なる表現部分空間を学習  |  h=8, d_model=512 → d_k=d_v=512/8=64  |  総パラメータ: 4 × d_model²</text>

  <!-- Dimension relationship box -->
  <rect x="760" y="50" width="185" height="100" rx="6" fill="#0f1520" stroke="#30363d" stroke-width="1"/>
  <text x="852" y="70" text-anchor="middle" fill="#94a3b8" font-size="11" font-weight="bold">次元の関係</text>
  <text x="770" y="90" fill="#e6edf3" font-size="10">d_model = h × d_k</text>
  <text x="770" y="108" fill="#e6edf3" font-size="10">512 = 8 × 64</text>
  <text x="770" y="126" fill="#94a3b8" font-size="10">各ヘッド: 64次元</text>
  <text x="770" y="144" fill="#94a3b8" font-size="10">Concat後: 512次元</text>
</svg>

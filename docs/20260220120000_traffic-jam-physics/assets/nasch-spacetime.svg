<svg viewBox="0 0 960 460" xmlns="http://www.w3.org/2000/svg" style="max-height:70vh;width:auto;display:block;margin:0 auto;letter-spacing:0;font-family:'Helvetica Neue',Arial,sans-serif">
  <rect width="960" height="460" fill="#0f172a" rx="12"/>
  <text x="480" y="34" text-anchor="middle" font-size="18" font-weight="bold" fill="#e2e8f0">Nagel-Schreckenberg モデル：時空間ダイアグラム</text>

  <!-- Axes -->
  <line x1="60" y1="408" x2="920" y2="408" stroke="#475569" stroke-width="2"/>
  <polygon points="924,408 914,403 914,413" fill="#475569"/>
  <text x="490" y="432" text-anchor="middle" font-size="12" fill="#64748b">空間（セル位置）→</text>

  <line x1="60" y1="408" x2="60" y2="52" stroke="#475569" stroke-width="2"/>
  <polygon points="60,48 55,58 65,58" fill="#475569"/>
  <text x="40" y="230" text-anchor="middle" font-size="12" fill="#64748b" transform="rotate(-90,40,230)">時間ステップ →</text>

  <!-- Grid cells - spacetime -->
  <!-- We'll draw 28 columns x 18 rows of cells -->
  <!-- Each cell is 30x20 -->
  <!-- Cars are colored dots in cells -->

  <!-- Row labels -->
  <text x="52" y="78" text-anchor="end" font-size="10" fill="#64748b">t=1</text>
  <text x="52" y="98" text-anchor="end" font-size="10" fill="#64748b">t=2</text>
  <text x="52" y="118" text-anchor="end" font-size="10" fill="#64748b">t=3</text>
  <text x="52" y="138" text-anchor="end" font-size="10" fill="#64748b">t=4</text>
  <text x="52" y="158" text-anchor="end" font-size="10" fill="#64748b">t=5</text>
  <text x="52" y="178" text-anchor="end" font-size="10" fill="#64748b">t=6</text>
  <text x="52" y="198" text-anchor="end" font-size="10" fill="#64748b">t=7</text>
  <text x="52" y="218" text-anchor="end" font-size="10" fill="#64748b">t=8</text>
  <text x="52" y="238" text-anchor="end" font-size="10" fill="#64748b">t=9</text>
  <text x="52" y="258" text-anchor="end" font-size="10" fill="#64748b">t=10</text>
  <text x="52" y="278" text-anchor="end" font-size="10" fill="#64748b">t=11</text>
  <text x="52" y="298" text-anchor="end" font-size="10" fill="#64748b">t=12</text>
  <text x="52" y="318" text-anchor="end" font-size="10" fill="#64748b">t=13</text>
  <text x="52" y="338" text-anchor="end" font-size="10" fill="#64748b">t=14</text>
  <text x="52" y="358" text-anchor="end" font-size="10" fill="#64748b">t=15</text>
  <text x="52" y="378" text-anchor="end" font-size="10" fill="#64748b">t=16</text>
  <text x="52" y="398" text-anchor="end" font-size="10" fill="#64748b">t=17</text>

  <!-- Car trajectories as colored rectangles - simulating NaSch model -->
  <!-- Free-flowing cars (green) move right steadily -->
  <!-- Jammed cars (red/orange) move slowly or stop -->

  <!-- Car 1 trajectory (free flow then jam) -->
  <rect x="63" y="68" width="26" height="14" rx="3" fill="#22c55e" opacity="0.9"/>
  <rect x="93" y="88" width="26" height="14" rx="3" fill="#22c55e" opacity="0.9"/>
  <rect x="123" y="108" width="26" height="14" rx="3" fill="#22c55e" opacity="0.9"/>
  <rect x="153" y="128" width="26" height="14" rx="3" fill="#22c55e" opacity="0.9"/>
  <rect x="183" y="148" width="26" height="14" rx="3" fill="#fbbf24" opacity="0.9"/>
  <rect x="193" y="168" width="26" height="14" rx="3" fill="#f97316" opacity="0.9"/>
  <rect x="193" y="188" width="26" height="14" rx="3" fill="#dc2626" opacity="0.9"/>
  <rect x="193" y="208" width="26" height="14" rx="3" fill="#dc2626" opacity="0.9"/>
  <rect x="203" y="228" width="26" height="14" rx="3" fill="#f97316" opacity="0.9"/>
  <rect x="223" y="248" width="26" height="14" rx="3" fill="#22c55e" opacity="0.9"/>
  <rect x="253" y="268" width="26" height="14" rx="3" fill="#22c55e" opacity="0.9"/>
  <rect x="283" y="288" width="26" height="14" rx="3" fill="#22c55e" opacity="0.9"/>
  <rect x="313" y="308" width="26" height="14" rx="3" fill="#22c55e" opacity="0.9"/>
  <rect x="343" y="328" width="26" height="14" rx="3" fill="#22c55e" opacity="0.9"/>
  <rect x="373" y="348" width="26" height="14" rx="3" fill="#22c55e" opacity="0.9"/>
  <rect x="403" y="368" width="26" height="14" rx="3" fill="#22c55e" opacity="0.9"/>
  <rect x="433" y="388" width="26" height="14" rx="3" fill="#22c55e" opacity="0.9"/>

  <!-- Car 2 trajectory -->
  <rect x="153" y="68" width="26" height="14" rx="3" fill="#22c55e" opacity="0.9"/>
  <rect x="183" y="88" width="26" height="14" rx="3" fill="#22c55e" opacity="0.9"/>
  <rect x="213" y="108" width="26" height="14" rx="3" fill="#22c55e" opacity="0.9"/>
  <rect x="243" y="128" width="26" height="14" rx="3" fill="#22c55e" opacity="0.9"/>
  <rect x="253" y="148" width="26" height="14" rx="3" fill="#fbbf24" opacity="0.9"/>
  <rect x="253" y="168" width="26" height="14" rx="3" fill="#dc2626" opacity="0.9"/>
  <rect x="253" y="188" width="26" height="14" rx="3" fill="#dc2626" opacity="0.9"/>
  <rect x="263" y="208" width="26" height="14" rx="3" fill="#f97316" opacity="0.9"/>
  <rect x="293" y="228" width="26" height="14" rx="3" fill="#22c55e" opacity="0.9"/>
  <rect x="323" y="248" width="26" height="14" rx="3" fill="#22c55e" opacity="0.9"/>
  <rect x="353" y="268" width="26" height="14" rx="3" fill="#22c55e" opacity="0.9"/>
  <rect x="383" y="288" width="26" height="14" rx="3" fill="#22c55e" opacity="0.9"/>
  <rect x="413" y="308" width="26" height="14" rx="3" fill="#22c55e" opacity="0.9"/>
  <rect x="443" y="328" width="26" height="14" rx="3" fill="#22c55e" opacity="0.9"/>
  <rect x="473" y="348" width="26" height="14" rx="3" fill="#22c55e" opacity="0.9"/>
  <rect x="503" y="368" width="26" height="14" rx="3" fill="#22c55e" opacity="0.9"/>
  <rect x="533" y="388" width="26" height="14" rx="3" fill="#22c55e" opacity="0.9"/>

  <!-- Car 3 (original disturber) trajectory -->
  <rect x="243" y="68" width="26" height="14" rx="3" fill="#22c55e" opacity="0.9"/>
  <rect x="273" y="88" width="26" height="14" rx="3" fill="#22c55e" opacity="0.9"/>
  <rect x="303" y="108" width="26" height="14" rx="3" fill="#22c55e" opacity="0.9"/>
  <rect x="333" y="128" width="26" height="14" rx="3" fill="#fbbf24" stroke="#f59e0b" stroke-width="2" opacity="1"/>
  <rect x="343" y="148" width="26" height="14" rx="3" fill="#22c55e" opacity="0.9"/>
  <rect x="373" y="168" width="26" height="14" rx="3" fill="#22c55e" opacity="0.9"/>
  <rect x="403" y="188" width="26" height="14" rx="3" fill="#22c55e" opacity="0.9"/>
  <rect x="433" y="208" width="26" height="14" rx="3" fill="#22c55e" opacity="0.9"/>
  <rect x="463" y="228" width="26" height="14" rx="3" fill="#22c55e" opacity="0.9"/>
  <rect x="493" y="248" width="26" height="14" rx="3" fill="#22c55e" opacity="0.9"/>
  <rect x="523" y="268" width="26" height="14" rx="3" fill="#22c55e" opacity="0.9"/>
  <rect x="553" y="288" width="26" height="14" rx="3" fill="#22c55e" opacity="0.9"/>
  <rect x="583" y="308" width="26" height="14" rx="3" fill="#22c55e" opacity="0.9"/>
  <rect x="613" y="328" width="26" height="14" rx="3" fill="#22c55e" opacity="0.9"/>
  <rect x="643" y="348" width="26" height="14" rx="3" fill="#22c55e" opacity="0.9"/>
  <rect x="673" y="368" width="26" height="14" rx="3" fill="#22c55e" opacity="0.9"/>
  <rect x="703" y="388" width="26" height="14" rx="3" fill="#22c55e" opacity="0.9"/>

  <!-- Jam wave annotation (diagonal line showing backward propagation) -->
  <line x1="183" y1="148" x2="243" y2="388" stroke="#f97316" stroke-width="2" stroke-dasharray="8,4" opacity="0.7"/>
  <text x="148" y="290" font-size="11" fill="#f97316" transform="rotate(-75,148,290)">渋滞波（後方伝播）</text>

  <!-- Legend -->
  <rect x="580" y="80" width="360" height="130" rx="10" fill="#1e293b" stroke="#334155" stroke-width="1.5"/>
  <text x="760" y="102" text-anchor="middle" font-size="12" font-weight="bold" fill="#e2e8f0">凡例</text>
  <rect x="600" y="112" width="20" height="12" rx="3" fill="#22c55e"/>
  <text x="628" y="123" font-size="11" fill="#e2e8f0">自由走行（v = v_max）</text>
  <rect x="600" y="132" width="20" height="12" rx="3" fill="#fbbf24"/>
  <text x="628" y="143" font-size="11" fill="#e2e8f0">減速中（ランダム化）</text>
  <rect x="600" y="152" width="20" height="12" rx="3" fill="#f97316"/>
  <text x="628" y="163" font-size="11" fill="#e2e8f0">低速走行</text>
  <rect x="600" y="172" width="20" height="12" rx="3" fill="#dc2626"/>
  <text x="628" y="183" font-size="11" fill="#e2e8f0">停止（v = 0）</text>
  <rect x="600" y="190" width="20" height="3" rx="1" fill="#f97316" opacity="0.7"/>
  <line x1="600" y1="191" x2="620" y2="191" stroke="#f97316" stroke-width="2" stroke-dasharray="4,2"/>
  <text x="628" y="198" font-size="11" fill="#e2e8f0">渋滞波フロント</text>

  <!-- NaSch rules box -->
  <rect x="580" y="225" width="360" height="140" rx="10" fill="#1e293b" stroke="#334155" stroke-width="1.5"/>
  <text x="760" y="247" text-anchor="middle" font-size="12" font-weight="bold" fill="#e2e8f0">NaSch モデルの4ルール</text>
  <text x="595" y="267" font-size="11" fill="#a5b4fc">① 加速: v ← min(v+1, v_max)</text>
  <text x="595" y="284" font-size="11" fill="#a5b4fc">② 減速: v ← min(v, gap)</text>
  <text x="595" y="301" font-size="11" fill="#fbbf24">③ ランダム化: v ← max(v-1, 0)（確率p）</text>
  <text x="595" y="318" font-size="11" fill="#a5b4fc">④ 移動: x ← x + v</text>
  <text x="760" y="348" text-anchor="middle" font-size="11" fill="#94a3b8">ランダム化③が自発的渋滞の源</text>
</svg>

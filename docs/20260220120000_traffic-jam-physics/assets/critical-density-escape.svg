<svg viewBox="0 0 960 460" xmlns="http://www.w3.org/2000/svg" style="max-height:70vh;width:auto;display:block;margin:0 auto;letter-spacing:0;font-family:'Helvetica Neue',Arial,sans-serif">
  <rect width="960" height="460" fill="#f8fafc" rx="12"/>
  <text x="480" y="36" text-anchor="middle" font-size="19" font-weight="bold" fill="#1e293b">渋滞消滅の条件：臨界密度とヒステリシスループ</text>

  <!-- Main phase diagram -->
  <rect x="40" y="55" width="550" height="360" rx="10" fill="#f0f9ff" stroke="#0ea5e9" stroke-width="1.5"/>
  <text x="315" y="80" text-anchor="middle" font-size="13" font-weight="bold" fill="#0c4a6e">密度 vs 流量：ヒステリシス領域</text>

  <!-- Axes -->
  <line x1="90" y1="370" x2="560" y2="370" stroke="#334155" stroke-width="2"/>
  <polygon points="564,370 554,365 554,375" fill="#334155"/>
  <line x1="90" y1="370" x2="90" y2="80" stroke="#334155" stroke-width="2"/>
  <polygon points="90,76 85,86 95,86" fill="#334155"/>

  <text x="325" y="390" text-anchor="middle" font-size="12" fill="#475569">密度 k →</text>
  <text x="68" y="225" text-anchor="middle" font-size="12" fill="#475569" transform="rotate(-90,68,225)">流量 q →</text>

  <!-- Tick marks -->
  <line x1="260" y1="370" x2="260" y2="375" stroke="#334155" stroke-width="1.5"/>
  <text x="260" y="388" text-anchor="middle" font-size="10" fill="#64748b">k₁ (発生閾値)</text>
  <line x1="380" y1="370" x2="380" y2="375" stroke="#334155" stroke-width="1.5"/>
  <text x="380" y="388" text-anchor="middle" font-size="10" fill="#64748b">k₂ (消滅閾値)</text>

  <!-- Hysteresis loop -->
  <!-- Upper branch: free flow -->
  <path d="M 90,365 Q 200,350 260,180 Q 290,110 310,100" fill="none" stroke="#22c55e" stroke-width="3"/>
  <!-- Breakdown at k1 -->
  <line x1="260" y1="180" x2="260" y2="330" stroke="#dc2626" stroke-width="2.5" stroke-dasharray="6,3"/>
  <polygon points="260,334 255,322 265,322" fill="#dc2626"/>
  <!-- Lower branch: congested flow -->
  <path d="M 260,330 Q 320,345 380,360 Q 450,365 540,368" fill="none" stroke="#dc2626" stroke-width="3"/>
  <!-- Recovery at k2 -->
  <line x1="380" y1="360" x2="380" y2="280" stroke="#22c55e" stroke-width="2.5" stroke-dasharray="6,3"/>
  <polygon points="380,276 375,288 385,288" fill="#22c55e"/>
  <!-- Continuation of free flow from k2 -->
  <path d="M 380,280 Q 340,200 310,100" fill="none" stroke="#22c55e" stroke-width="2" stroke-dasharray="4,3"/>

  <!-- Hysteresis region shading -->
  <polygon points="260,180 310,100 380,280 260,330" fill="#fef9c3" opacity="0.6"/>
  <text x="315" y="240" text-anchor="middle" font-size="12" fill="#92400e" font-weight="bold">ヒステリシス</text>
  <text x="315" y="257" text-anchor="middle" font-size="11" fill="#92400e">領域</text>

  <!-- Critical point -->
  <circle cx="310" cy="100" r="8" fill="#f59e0b" stroke="#d97706" stroke-width="2"/>
  <text x="322" y="96" font-size="11" fill="#92400e" font-weight="bold">q_max</text>

  <!-- Arrows showing direction of transitions -->
  <text x="145" y="265" font-size="12" fill="#22c55e" font-weight="bold">↑ 自由流</text>
  <text x="420" y="345" font-size="12" fill="#dc2626" font-weight="bold">↓ 渋滞流</text>

  <!-- Transition labels -->
  <text x="216" y="260" font-size="10" fill="#dc2626">渋滞突入</text>
  <text x="216" y="273" font-size="10" fill="#dc2626">（急落下）</text>
  <text x="390" y="320" font-size="10" fill="#22c55e">渋滞解消</text>
  <text x="390" y="333" font-size="10" fill="#22c55e">（k &lt;&lt; k_cr）</text>

  <!-- Right panel: key insights -->
  <rect x="620" y="55" width="320" height="360" rx="10" fill="#fef9e7" stroke="#f59e0b" stroke-width="2"/>
  <text x="780" y="82" text-anchor="middle" font-size="14" font-weight="bold" fill="#92400e">渋滞が消えない3つの理由</text>

  <rect x="635" y="95" width="290" height="80" rx="8" fill="#fee2e2" stroke="#dc2626" stroke-width="1.5"/>
  <text x="780" y="116" text-anchor="middle" font-size="12" font-weight="bold" fill="#991b1b">① ヒステリシス効果</text>
  <text x="780" y="134" text-anchor="middle" font-size="11" fill="#7f1d1d">消滅には発生よりはるかに</text>
  <text x="780" y="150" text-anchor="middle" font-size="11" fill="#7f1d1d">低い密度が必要（k₂ &lt;&lt; k₁）</text>
  <text x="780" y="166" text-anchor="middle" font-size="10" fill="#dc2626">≒ コードの hot path は冷えにくい</text>

  <rect x="635" y="185" width="290" height="80" rx="8" fill="#fff7ed" stroke="#f97316" stroke-width="1.5"/>
  <text x="780" y="206" text-anchor="middle" font-size="12" font-weight="bold" fill="#9a3412">② 後流効果（Wake effect）</text>
  <text x="780" y="224" text-anchor="middle" font-size="11" fill="#7c2d12">渋滞末尾への追突リスクが</text>
  <text x="780" y="240" text-anchor="middle" font-size="11" fill="#7c2d12">さらなる制動を呼び込む</text>
  <text x="780" y="256" text-anchor="middle" font-size="10" fill="#f97316">≒ GC pause が連鎖するパターン</text>

  <rect x="635" y="275" width="290" height="80" rx="8" fill="#f0fdf4" stroke="#22c55e" stroke-width="1.5"/>
  <text x="780" y="296" text-anchor="middle" font-size="12" font-weight="bold" fill="#166534">③ 自己組織化（SOC）</text>
  <text x="780" y="314" text-anchor="middle" font-size="11" fill="#14532d">系が臨界状態に向かう内在的</text>
  <text x="780" y="330" text-anchor="middle" font-size="11" fill="#14532d">傾向（砂山モデル）</text>
  <text x="780" y="346" text-anchor="middle" font-size="10" fill="#22c55e">≒ メモリ・CPU が常に飽和へ</text>

  <!-- Bottom note -->
  <text x="480" y="440" text-anchor="middle" font-size="12" fill="#475569">消滅条件: 局所的な車頭時間を 1/q_max 以上に保つか、外部介入（オンランプ制御など）が必要</text>
</svg>

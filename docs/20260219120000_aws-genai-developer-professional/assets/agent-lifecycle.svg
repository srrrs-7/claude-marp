<svg viewBox="0 0 900 380" style="max-height:70vh;max-width:100%;display:block;margin:0 auto;letter-spacing:0" font-family="Arial,sans-serif">
  <rect width="900" height="380" fill="#F0F4F8"/>
  <text x="450" y="28" text-anchor="middle" font-size="17" font-weight="bold" fill="#232F3E">Bedrock Agent — 実行ライフサイクル</text>

  <!-- States as boxes with arrows -->
  <!-- State 1: User Input -->
  <rect x="20" y="120" width="130" height="70" rx="10" fill="#232F3E"/>
  <text x="85" y="148" text-anchor="middle" font-size="12" font-weight="bold" fill="white">ユーザー入力</text>
  <text x="85" y="167" text-anchor="middle" font-size="11" fill="#FFB74D">セッション開始</text>
  <text x="85" y="181" text-anchor="middle" font-size="10" fill="#888">sessionId生成</text>

  <line x1="150" y1="155" x2="190" y2="155" stroke="#FF9900" stroke-width="2.5"/>
  <polygon points="190,150 200,155 190,160" fill="#FF9900"/>

  <!-- State 2: Pre-processing -->
  <rect x="200" y="110" width="140" height="90" rx="10" fill="#1A73E8" style="filter:drop-shadow(2px 2px 4px rgba(0,0,0,0.2))"/>
  <text x="270" y="136" text-anchor="middle" font-size="12" font-weight="bold" fill="white">前処理</text>
  <text x="270" y="154" text-anchor="middle" font-size="11" fill="#BBDEFB">Guardrails確認</text>
  <text x="270" y="171" text-anchor="middle" font-size="11" fill="#BBDEFB">プロンプト構築</text>
  <text x="270" y="188" text-anchor="middle" font-size="11" fill="#BBDEFB">コンテキスト注入</text>

  <line x1="340" y1="155" x2="380" y2="155" stroke="#FF9900" stroke-width="2.5"/>
  <polygon points="380,150 390,155 380,160" fill="#FF9900"/>

  <!-- State 3: Orchestration Loop -->
  <rect x="390" y="80" width="180" height="160" rx="10" fill="#FF9900" style="filter:drop-shadow(3px 3px 6px rgba(0,0,0,0.25))"/>
  <text x="480" y="108" text-anchor="middle" font-size="13" font-weight="bold" fill="white">オーケストレーション</text>
  <text x="480" y="126" text-anchor="middle" font-size="11" fill="#FFF3E0">LLM推論 (Think)</text>
  <line x1="430" y1="132" x2="540" y2="132" stroke="white" stroke-width="1"/>
  <text x="480" y="150" text-anchor="middle" font-size="11" fill="#FFF3E0">ツール選択 (Act)</text>
  <text x="480" y="168" text-anchor="middle" font-size="11" fill="#FFF3E0">アクション実行</text>
  <text x="480" y="186" text-anchor="middle" font-size="11" fill="#FFF3E0">結果観察 (Observe)</text>
  <rect x="410" y="196" width="140" height="30" rx="6" fill="#E67700"/>
  <text x="480" y="216" text-anchor="middle" font-size="11" fill="white">ループ継続 or 完了判定</text>

  <!-- Loop arrow -->
  <path d="M 570 155 Q 640 100 640 155 Q 640 210 570 210" stroke="#FF9900" stroke-width="2" fill="none" stroke-dasharray="6,3"/>
  <polygon points="565,205 570,215 575,205" fill="#FF9900"/>
  <text x="660" y="155" font-size="11" fill="#E67700">ReAct</text>
  <text x="660" y="172" font-size="11" fill="#E67700">ループ</text>

  <line x1="570" y1="160" x2="700" y2="160" stroke="#1A9C3E" stroke-width="2.5"/>
  <polygon points="700,155 710,160 700,165" fill="#1A9C3E"/>

  <!-- State 4: Post-processing -->
  <rect x="710" y="110" width="140" height="90" rx="10" fill="#1A9C3E" style="filter:drop-shadow(2px 2px 4px rgba(0,0,0,0.2))"/>
  <text x="780" y="136" text-anchor="middle" font-size="12" font-weight="bold" fill="white">後処理</text>
  <text x="780" y="154" text-anchor="middle" font-size="11" fill="#C8E6C9">Guardrails出力確認</text>
  <text x="780" y="171" text-anchor="middle" font-size="11" fill="#C8E6C9">回答フォーマット</text>
  <text x="780" y="188" text-anchor="middle" font-size="11" fill="#C8E6C9">セッション更新</text>

  <!-- Memory/Session -->
  <rect x="200" y="280" width="500" height="80" rx="10" fill="#7B1FA2"/>
  <text x="450" y="304" text-anchor="middle" font-size="13" font-weight="bold" fill="white">セッション管理とメモリ</text>
  <text x="230" y="325" font-size="11" fill="#E1BEE7">・sessionId: 会話の継続性を維持</text>
  <text x="230" y="343" font-size="11" fill="#E1BEE7">・sessionAttributes: セッション変数の保持</text>
  <text x="500" y="325" font-size="11" fill="#E1BEE7">・promptSessionAttributes: ターン間の引継ぎ</text>
  <text x="500" y="343" font-size="11" fill="#E1BEE7">・memoryId: 会話履歴の長期保存 (Memory機能)</text>

  <!-- Lines connecting to memory -->
  <line x1="270" y1="200" x2="330" y2="280" stroke="#7B1FA2" stroke-width="1.5" stroke-dasharray="4,2"/>
  <line x1="480" y1="240" x2="450" y2="280" stroke="#7B1FA2" stroke-width="1.5" stroke-dasharray="4,2"/>

  <!-- Note -->
  <rect x="20" y="350" width="860" height="22" rx="4" fill="#232F3E"/>
  <text x="450" y="365" text-anchor="middle" font-size="11" fill="#FF9900">試験: sessionId が同一の間は会話コンテキストが保持される / 最大実行ステップ数 = maxAgentDurationSeconds で制御</text>
</svg>

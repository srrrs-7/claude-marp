<svg viewBox="0 0 1100 540" xmlns="http://www.w3.org/2000/svg" style="max-height:70vh;width:auto;display:block;margin:0 auto;letter-spacing:0">
  <rect width="1100" height="540" fill="#1e1e2e"/>

  <!-- Actor positions: User=130, SP=550, IdP=970 -->
  <!-- Actor: User/Browser -->
  <rect x="30" y="20" width="200" height="50" fill="#313244" stroke="#89b4fa" stroke-width="2" rx="8"/>
  <text x="130" y="44" text-anchor="middle" font-size="14" font-weight="bold" fill="#89b4fa" font-family="sans-serif">User / Browser</text>
  <text x="130" y="62" text-anchor="middle" font-size="11" fill="#a6adc8" font-family="sans-serif">End User</text>
  <!-- Actor: Service Provider -->
  <rect x="450" y="20" width="200" height="50" fill="#313244" stroke="#f38ba8" stroke-width="2" rx="8"/>
  <text x="550" y="44" text-anchor="middle" font-size="14" font-weight="bold" fill="#f38ba8" font-family="sans-serif">Service Provider</text>
  <text x="550" y="62" text-anchor="middle" font-size="11" fill="#a6adc8" font-family="sans-serif">Web Application (SP)</text>
  <!-- Actor: Identity Provider -->
  <rect x="870" y="20" width="200" height="50" fill="#313244" stroke="#cba6f7" stroke-width="2" rx="8"/>
  <text x="970" y="44" text-anchor="middle" font-size="14" font-weight="bold" fill="#cba6f7" font-family="sans-serif">Identity Provider</text>
  <text x="970" y="62" text-anchor="middle" font-size="11" fill="#a6adc8" font-family="sans-serif">ADFS / Okta / Azure AD</text>

  <!-- Lifelines -->
  <line x1="130" y1="70" x2="130" y2="510" stroke="#45475a" stroke-width="1.5" stroke-dasharray="6,4"/>
  <line x1="550" y1="70" x2="550" y2="510" stroke="#45475a" stroke-width="1.5" stroke-dasharray="6,4"/>
  <line x1="970" y1="70" x2="970" y2="510" stroke="#45475a" stroke-width="1.5" stroke-dasharray="6,4"/>

  <!-- Step 1: User → SP -->
  <line x1="130" y1="105" x2="540" y2="105" stroke="#89b4fa" stroke-width="1.5"/>
  <polygon points="540,100 550,105 540,110" fill="#89b4fa"/>
  <rect x="200" y="85" width="260" height="16" fill="#1e1e2e"/>
  <text x="340" y="97" text-anchor="middle" font-size="12" fill="#f9e2af" font-family="sans-serif">① GET /protected-resource</text>

  <!-- Step 2: SP → User (redirect) -->
  <line x1="550" y1="150" x2="140" y2="150" stroke="#a6e3a1" stroke-width="1.5" stroke-dasharray="8,3"/>
  <polygon points="140,145 130,150 140,155" fill="#a6e3a1"/>
  <rect x="200" y="130" width="295" height="16" fill="#1e1e2e"/>
  <text x="340" y="142" text-anchor="middle" font-size="12" fill="#f9e2af" font-family="sans-serif">② 302 Redirect → IdP (SAMLRequest encoded)</text>

  <!-- Step 3: User → IdP (long arrow) -->
  <line x1="130" y1="195" x2="960" y2="195" stroke="#89b4fa" stroke-width="1.5"/>
  <polygon points="960,190 970,195 960,200" fill="#89b4fa"/>
  <rect x="350" y="175" width="320" height="16" fill="#1e1e2e"/>
  <text x="550" y="187" text-anchor="middle" font-size="12" fill="#f9e2af" font-family="sans-serif">③ GET /idp/SSO?SAMLRequest=&lt;encoded&gt;</text>

  <!-- Step 4: IdP → User (login form) -->
  <line x1="970" y1="240" x2="140" y2="240" stroke="#a6e3a1" stroke-width="1.5" stroke-dasharray="8,3"/>
  <polygon points="140,235 130,240 140,245" fill="#a6e3a1"/>
  <rect x="350" y="220" width="280" height="16" fill="#1e1e2e"/>
  <text x="550" y="232" text-anchor="middle" font-size="12" fill="#f9e2af" font-family="sans-serif">④ 200 OK: Login page (HTML form)</text>

  <!-- Step 5: User → IdP (credentials) -->
  <line x1="130" y1="285" x2="960" y2="285" stroke="#89b4fa" stroke-width="1.5"/>
  <polygon points="960,280 970,285 960,290" fill="#89b4fa"/>
  <rect x="350" y="265" width="265" height="16" fill="#1e1e2e"/>
  <text x="550" y="277" text-anchor="middle" font-size="12" fill="#f9e2af" font-family="sans-serif">⑤ POST /idp/login (username + password)</text>

  <!-- Step 6: IdP → User (SAML response HTML form) -->
  <line x1="970" y1="330" x2="140" y2="330" stroke="#a6e3a1" stroke-width="1.5" stroke-dasharray="8,3"/>
  <polygon points="140,325 130,330 140,335" fill="#a6e3a1"/>
  <rect x="310" y="310" width="360" height="16" fill="#1e1e2e"/>
  <text x="550" y="322" text-anchor="middle" font-size="12" fill="#fab387" font-family="sans-serif">⑥ 200 OK: HTML form (SAMLResponse Base64 encoded)</text>

  <!-- Step 7: User → SP (POST SAMLResponse) -->
  <line x1="130" y1="375" x2="540" y2="375" stroke="#89b4fa" stroke-width="2"/>
  <polygon points="540,370 550,375 540,380" fill="#89b4fa"/>
  <rect x="180" y="355" width="290" height="16" fill="#1e1e2e"/>
  <text x="340" y="367" text-anchor="middle" font-size="12" fill="#fab387" font-family="sans-serif">⑦ POST /sp/acs (SAMLResponse=&lt;Base64&gt;)</text>
  <!-- Auto-submit note -->
  <rect x="40" y="388" width="170" height="20" fill="#2a2a3e" stroke="#45475a" rx="3"/>
  <text x="125" y="402" text-anchor="middle" font-size="10" fill="#6c7086" font-family="sans-serif">※ JavaScript auto-submit</text>

  <!-- Step 8: SP → User (session established) -->
  <line x1="550" y1="435" x2="140" y2="435" stroke="#a6e3a1" stroke-width="2" stroke-dasharray="8,3"/>
  <polygon points="140,430 130,435 140,440" fill="#a6e3a1"/>
  <rect x="180" y="415" width="295" height="16" fill="#1e1e2e"/>
  <text x="340" y="427" text-anchor="middle" font-size="12" fill="#a6e3a1" font-family="sans-serif">⑧ 302 Redirect: Set-Cookie (session) → Resource</text>

  <!-- SP validates SAML note -->
  <rect x="440" y="388" width="230" height="40" fill="#2a2a3e" stroke="#f38ba8" stroke-width="1" rx="5"/>
  <text x="555" y="403" text-anchor="middle" font-size="11" fill="#f38ba8" font-family="sans-serif">SP validates:</text>
  <text x="555" y="420" text-anchor="middle" font-size="10" fill="#a6adc8" font-family="sans-serif">Signature + Conditions + Audience</text>

  <!-- Legend -->
  <line x1="30" y1="490" x2="70" y2="490" stroke="#89b4fa" stroke-width="1.5"/>
  <polygon points="70,485 80,490 70,495" fill="#89b4fa"/>
  <text x="90" y="494" font-size="11" fill="#89b4fa" font-family="sans-serif">Request</text>
  <line x1="170" y1="490" x2="210" y2="490" stroke="#a6e3a1" stroke-width="1.5" stroke-dasharray="8,3"/>
  <polygon points="210,485 220,490 210,495" fill="#a6e3a1"/>
  <text x="230" y="494" font-size="11" fill="#a6e3a1" font-family="sans-serif">Response</text>
  <line x1="320" y1="490" x2="360" y2="490" stroke="#fab387" stroke-width="2"/>
  <polygon points="360,485 370,490 360,495" fill="#fab387"/>
  <text x="380" y="494" font-size="11" fill="#fab387" font-family="sans-serif">SAML Assertion (critical)</text>
</svg>

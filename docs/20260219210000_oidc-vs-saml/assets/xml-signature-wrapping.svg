<svg viewBox="0 0 1050 500" xmlns="http://www.w3.org/2000/svg" style="max-height:70vh;width:auto;display:block;margin:0 auto;letter-spacing:0">
  <rect width="1050" height="500" fill="#1e1e2e"/>

  <!-- Title -->
  <text x="525" y="22" text-anchor="middle" font-size="15" font-weight="bold" fill="#f38ba8" font-family="sans-serif">XML Signature Wrapping (XSW) æ”»æ’ƒ</text>
  <text x="525" y="40" text-anchor="middle" font-size="11" fill="#6c7086" font-family="sans-serif">SAML ã®æœ€ã‚‚å±é™ºãªè„†å¼±æ€§ â€” ç½²åã¯æœ‰åŠ¹ãªã®ã«åˆ¥ã®è¦ç´ ãŒæ¤œè¨¼ã•ã‚Œã‚‹</text>

  <!-- Normal flow (left) -->
  <rect x="20" y="52" width="460" height="210" fill="#1a2a1a" stroke="#a6e3a1" stroke-width="1.5" rx="8"/>
  <text x="250" y="72" text-anchor="middle" font-size="13" font-weight="bold" fill="#a6e3a1" font-family="sans-serif">â‘  æ­£å¸¸ãªãƒªã‚¯ã‚¨ã‚¹ãƒˆ</text>

  <!-- Normal SAML structure -->
  <rect x="35" y="82" width="430" height="168" fill="#181825" stroke="#45475a" rx="4"/>
  <text x="50" y="102" font-size="11" fill="#a6e3a1" font-family="monospace">&lt;Response&gt;</text>
  <text x="65" y="120" font-size="11" fill="#cba6f7" font-family="monospace">&lt;Assertion ID="a1"&gt;</text>
  <text x="80" y="138" font-size="11" fill="#cdd6f4" font-family="monospace">&lt;Subject&gt;</text>
  <text x="95" y="156" font-size="11" fill="#a6e3a1" font-family="monospace">&lt;NameID&gt;alice&lt;/NameID&gt;</text>
  <text x="80" y="174" font-size="11" fill="#cdd6f4" font-family="monospace">&lt;/Subject&gt;</text>
  <text x="80" y="192" font-size="11" fill="#89b4fa" font-family="monospace">&lt;Signature ref="#a1"/&gt;</text>
  <text x="65" y="210" font-size="11" fill="#cba6f7" font-family="monospace">&lt;/Assertion&gt;</text>
  <text x="50" y="228" font-size="11" fill="#a6e3a1" font-family="monospace">&lt;/Response&gt;</text>
  <!-- Signature points to Assertion -->
  <line x1="208" y1="192" x2="208" y2="175" stroke="#89b4fa" stroke-width="1" stroke-dasharray="4,2"/>
  <text x="215" y="186" font-size="9" fill="#89b4fa" font-family="sans-serif">a1ã‚’ç½²å</text>

  <!-- Verification note for normal -->
  <rect x="35" y="256" width="430" height="40" fill="#1a2a1a" stroke="#a6e3a1" rx="3"/>
  <text x="250" y="271" text-anchor="middle" font-size="11" fill="#a6e3a1" font-family="sans-serif">SP: Assertion#a1 ã‚’æ¤œè¨¼ â†’ ç½²å OK</text>
  <text x="250" y="288" text-anchor="middle" font-size="11" fill="#a6e3a1" font-family="sans-serif">â†’ alice ã¨ã—ã¦ãƒ­ã‚°ã‚¤ãƒ³è¨±å¯ âœ“</text>

  <!-- Arrow between normal and attack -->
  <text x="525" y="180" text-anchor="middle" font-size="28" fill="#f38ba8" font-family="sans-serif">â‡’</text>
  <text x="525" y="200" text-anchor="middle" font-size="11" fill="#f38ba8" font-family="sans-serif">æ”»æ’ƒè€…ãŒ</text>
  <text x="525" y="215" text-anchor="middle" font-size="11" fill="#f38ba8" font-family="sans-serif">æ”¹ã–ã‚“</text>

  <!-- Attack flow (right) -->
  <rect x="570" y="52" width="460" height="210" fill="#2a1a1a" stroke="#f38ba8" stroke-width="2" rx="8"/>
  <text x="800" y="72" text-anchor="middle" font-size="13" font-weight="bold" fill="#f38ba8" font-family="sans-serif">â‘¡ XSW æ”»æ’ƒãƒªã‚¯ã‚¨ã‚¹ãƒˆ</text>

  <!-- Malicious SAML structure -->
  <rect x="585" y="82" width="430" height="168" fill="#181825" stroke="#45475a" rx="4"/>
  <text x="600" y="102" font-size="11" fill="#a6e3a1" font-family="monospace">&lt;Response&gt;</text>
  <!-- Evil assertion (attacker's) -->
  <rect x="600" y="106" width="400" height="55" fill="#3a1a1a" stroke="#f38ba8" rx="2"/>
  <text x="615" y="122" font-size="11" fill="#f38ba8" font-family="monospace">&lt;Assertion ID="evil"&gt;  &lt;!-- å½ã® --&gt;</text>
  <text x="630" y="140" font-size="11" fill="#f38ba8" font-family="monospace">&lt;NameID&gt;admin&lt;/NameID&gt;</text>
  <text x="615" y="158" font-size="11" fill="#f38ba8" font-family="monospace">&lt;/Assertion&gt;</text>
  <!-- Original signed assertion (still valid) -->
  <text x="615" y="178" font-size="11" fill="#cba6f7" font-family="monospace">&lt;Assertion ID="a1"&gt;  &lt;!-- å…ƒã® --&gt;</text>
  <text x="630" y="196" font-size="11" fill="#a6e3a1" font-family="monospace">&lt;NameID&gt;alice&lt;/NameID&gt;</text>
  <text x="630" y="214" font-size="11" fill="#89b4fa" font-family="monospace">&lt;Signature ref="#a1"/&gt;</text>
  <text x="615" y="232" font-size="11" fill="#cba6f7" font-family="monospace">&lt;/Assertion&gt;</text>
  <text x="600" y="248" font-size="11" fill="#a6e3a1" font-family="monospace">&lt;/Response&gt;</text>

  <!-- Verification note for attack -->
  <rect x="585" y="268" width="430" height="54" fill="#2a1a1a" stroke="#f38ba8" rx="3"/>
  <text x="800" y="285" text-anchor="middle" font-size="11" fill="#f38ba8" font-family="sans-serif">è„†å¼±ãª SP: æœ€åˆã® Assertion (evil) ã‚’ä½¿ç”¨</text>
  <text x="800" y="302" text-anchor="middle" font-size="11" fill="#f38ba8" font-family="sans-serif">ç½²åæ¤œè¨¼: Assertion#a1 â†’ alice âœ“ (æœ‰åŠ¹!)</text>
  <text x="800" y="318" text-anchor="middle" font-size="11" fill="#f38ba8" font-family="sans-serif">â†’ admin ã¨ã—ã¦ãƒ­ã‚°ã‚¤ãƒ³ ğŸ’€</text>

  <!-- Root cause explanation -->
  <rect x="20" y="332" width="1010" height="80" fill="#181825" stroke="#f38ba8" stroke-width="1.5" rx="8"/>
  <text x="525" y="352" text-anchor="middle" font-size="13" font-weight="bold" fill="#f38ba8" font-family="sans-serif">æ ¹æœ¬åŸå› ã¨å¯¾ç­–</text>
  <!-- Cause -->
  <rect x="30" y="358" width="490" height="46" fill="#2a1a1a" stroke="#f38ba8" stroke-width="1" rx="4"/>
  <text x="275" y="374" text-anchor="middle" font-size="11" fill="#f38ba8" font-family="sans-serif">åŸå› : ç½²åæ¤œè¨¼ã¨ ID å‚ç…§ã®ä¸æ•´åˆ</text>
  <text x="275" y="390" text-anchor="middle" font-size="10" fill="#a6adc8" font-family="sans-serif">ç½²åãŒ "#a1" ã‚’æŒ‡ã™ã®ã« SP ãŒåˆ¥ã®è¦ç´  "evil" ã‚’å‡¦ç†</text>
  <text x="275" y="404" text-anchor="middle" font-size="10" fill="#a6adc8" font-family="sans-serif">XML ãƒ‘ãƒ¼ã‚µãƒ¼ã«ã‚ˆã£ã¦æŒ™å‹•ãŒç•°ãªã‚‹ (JAXB, minidom, etc.)</text>
  <!-- Countermeasure -->
  <rect x="530" y="358" width="490" height="46" fill="#1a2a1a" stroke="#a6e3a1" stroke-width="1" rx="4"/>
  <text x="775" y="374" text-anchor="middle" font-size="11" fill="#a6e3a1" font-family="sans-serif">å¯¾ç­–: ID ã¨ç½²åå‚ç…§ã‚’å¿…ãšä¸€è‡´ç¢ºèª</text>
  <text x="775" y="390" text-anchor="middle" font-size="10" fill="#a6adc8" font-family="sans-serif">â‘  Signature ã® Reference URI ãŒ Assertion ã® ID ã¨ä¸€è‡´ã™ã‚‹ã‹ç¢ºèª</text>
  <text x="775" y="404" text-anchor="middle" font-size="10" fill="#a6adc8" font-family="sans-serif">â‘¡ æ¤œè¨¼æ¸ˆã¿ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã‚’ä½¿ç”¨ (OneLogin, Shibboleth, etc.)</text>

  <!-- CVE note -->
  <rect x="20" y="420" width="1010" height="60" fill="#181825" stroke="#45475a" rx="4"/>
  <text x="525" y="438" text-anchor="middle" font-size="12" font-weight="bold" fill="#fab387" font-family="sans-serif">è‘—åãª XSW é–¢é€£ã‚¤ãƒ³ã‚·ãƒ‡ãƒ³ãƒˆ</text>
  <text x="30" y="456" font-size="10" fill="#a6adc8" font-family="sans-serif">â€¢ Duo Security (2017): SAML SSO å®Ÿè£…ã® XSW è„†å¼±æ€§ â€” GitHub, Oktaãªã©ã®SAMLå®Ÿè£…ã«å½±éŸ¿</text>
  <text x="30" y="472" font-size="10" fill="#a6adc8" font-family="sans-serif">â€¢ Ruby-saml (CVE-2015-20031): è¤‡æ•°ã®è„†å¼±å®Ÿè£…ã§ç®¡ç†è€…æ¨©é™å–å¾—ãŒå¯èƒ½ã€‚Python-saml ã‚‚åŒæ§˜</text>
</svg>
